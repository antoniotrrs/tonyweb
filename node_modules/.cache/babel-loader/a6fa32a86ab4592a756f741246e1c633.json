{"ast":null,"code":"import \"core-js/modules/es.number.constructor.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array.flat.js\";\nimport \"core-js/modules/es.array.unscopables.flat.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.string.includes.js\";\n// Composables\nimport { useDate } from \"./date/date.js\";\nimport { useProxiedModel } from \"./proxiedModel.js\"; // Utilities\n\nimport { computed } from 'vue';\nimport { propsFactory, wrapInArray } from \"../util/index.js\"; // Types\n// Types\n// Composables\n\nexport var makeCalendarProps = propsFactory({\n  allowedDates: [Array, Function],\n  disabled: {\n    type: Boolean,\n    default: null\n  },\n  displayValue: null,\n  modelValue: Array,\n  month: [Number, String],\n  max: null,\n  min: null,\n  showAdjacentMonths: Boolean,\n  year: [Number, String],\n  weekdays: {\n    type: Array,\n    default: function _default() {\n      return [0, 1, 2, 3, 4, 5, 6];\n    }\n  },\n  weeksInMonth: {\n    type: String,\n    default: 'dynamic'\n  },\n  firstDayOfWeek: {\n    type: [Number, String],\n    default: undefined\n  }\n}, 'calendar');\nexport function useCalendar(props) {\n  var adapter = useDate();\n  var model = useProxiedModel(props, 'modelValue', [], function (v) {\n    return wrapInArray(v).map(function (i) {\n      return adapter.date(i);\n    });\n  });\n  var displayValue = computed(function () {\n    if (props.displayValue) return adapter.date(props.displayValue);\n    if (model.value.length > 0) return adapter.date(model.value[0]);\n    if (props.min) return adapter.date(props.min);\n    if (Array.isArray(props.allowedDates)) return adapter.date(props.allowedDates[0]);\n    return adapter.date();\n  });\n  var year = useProxiedModel(props, 'year', undefined, function (v) {\n    var value = v != null ? Number(v) : adapter.getYear(displayValue.value);\n    return adapter.startOfYear(adapter.setYear(adapter.date(), value));\n  }, function (v) {\n    return adapter.getYear(v);\n  });\n  var month = useProxiedModel(props, 'month', undefined, function (v) {\n    var value = v != null ? Number(v) : adapter.getMonth(displayValue.value);\n    var date = adapter.setYear(adapter.startOfMonth(adapter.date()), adapter.getYear(year.value));\n    return adapter.setMonth(date, value);\n  }, function (v) {\n    return adapter.getMonth(v);\n  });\n  var weekDays = computed(function () {\n    var firstDayOfWeek = adapter.toJsDate(adapter.startOfWeek(adapter.date(), props.firstDayOfWeek)).getDay(); // Always generate all days, regardless of props.weekdays\n\n    return [0, 1, 2, 3, 4, 5, 6].map(function (day) {\n      return (day + firstDayOfWeek) % 7;\n    });\n  });\n  var weeksInMonth = computed(function () {\n    var weeks = adapter.getWeekArray(month.value, props.firstDayOfWeek);\n    var days = weeks.flat(); // Make sure there's always 6 weeks in month (6 * 7 days)\n    // if weeksInMonth is 'static'\n\n    var daysInMonth = 6 * 7;\n\n    if (props.weeksInMonth === 'static' && days.length < daysInMonth) {\n      var lastDay = days[days.length - 1];\n      var week = [];\n\n      for (var day = 1; day <= daysInMonth - days.length; day++) {\n        week.push(adapter.addDays(lastDay, day));\n\n        if (day % 7 === 0) {\n          weeks.push(week);\n          week = [];\n        }\n      }\n    }\n\n    return weeks;\n  });\n\n  function genDays(days, today) {\n    return days.filter(function (date) {\n      return weekDays.value.includes(adapter.toJsDate(date).getDay());\n    }).map(function (date, index) {\n      var isoDate = adapter.toISO(date);\n      var isAdjacent = !adapter.isSameMonth(date, month.value);\n      var isStart = adapter.isSameDay(date, adapter.startOfMonth(month.value));\n      var isEnd = adapter.isSameDay(date, adapter.endOfMonth(month.value));\n      var isSame = adapter.isSameDay(date, month.value);\n      return {\n        date: date,\n        isoDate: isoDate,\n        formatted: adapter.format(date, 'keyboardDate'),\n        year: adapter.getYear(date),\n        month: adapter.getMonth(date),\n        isDisabled: isDisabled(date),\n        isWeekStart: index % 7 === 0,\n        isWeekEnd: index % 7 === 6,\n        isToday: adapter.isSameDay(date, today),\n        isAdjacent: isAdjacent,\n        isHidden: isAdjacent && !props.showAdjacentMonths,\n        isStart: isStart,\n        isSelected: model.value.some(function (value) {\n          return adapter.isSameDay(date, value);\n        }),\n        isEnd: isEnd,\n        isSame: isSame,\n        localized: adapter.format(date, 'dayOfMonth')\n      };\n    });\n  }\n\n  var daysInWeek = computed(function () {\n    var lastDay = adapter.startOfWeek(displayValue.value, props.firstDayOfWeek);\n    var week = [];\n\n    for (var day = 0; day <= 6; day++) {\n      week.push(adapter.addDays(lastDay, day));\n    }\n\n    var today = adapter.date();\n    return genDays(week, today);\n  });\n  var daysInMonth = computed(function () {\n    var days = weeksInMonth.value.flat();\n    var today = adapter.date();\n    return genDays(days, today);\n  });\n  var weekNumbers = computed(function () {\n    return weeksInMonth.value.map(function (week) {\n      return week.length ? adapter.getWeek(week[0], props.firstDayOfWeek) : null;\n    });\n  });\n\n  function isDisabled(value) {\n    if (props.disabled) return true;\n    var date = adapter.date(value);\n    if (props.min && adapter.isAfter(adapter.date(props.min), date)) return true;\n    if (props.max && adapter.isAfter(date, adapter.date(props.max))) return true;\n\n    if (Array.isArray(props.allowedDates) && props.allowedDates.length > 0) {\n      return !props.allowedDates.some(function (d) {\n        return adapter.isSameDay(adapter.date(d), date);\n      });\n    }\n\n    if (typeof props.allowedDates === 'function') {\n      return !props.allowedDates(date);\n    }\n\n    return !props.weekdays.includes(adapter.toJsDate(date).getDay());\n  }\n\n  return {\n    displayValue: displayValue,\n    daysInMonth: daysInMonth,\n    daysInWeek: daysInWeek,\n    genDays: genDays,\n    model: model,\n    weeksInMonth: weeksInMonth,\n    weekDays: weekDays,\n    weekNumbers: weekNumbers\n  };\n}","map":{"version":3,"mappings":"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","names":["useDate","useProxiedModel","computed","propsFactory","wrapInArray","makeCalendarProps","allowedDates","Array","Function","disabled","type","Boolean","default","displayValue","modelValue","month","Number","String","max","min","showAdjacentMonths","year","weekdays","weeksInMonth","firstDayOfWeek","undefined","useCalendar","props","adapter","model","v","map","i","date","value","length","isArray","getYear","startOfYear","setYear","getMonth","startOfMonth","setMonth","weekDays","toJsDate","startOfWeek","getDay","day","weeks","getWeekArray","days","flat","daysInMonth","lastDay","week","push","addDays","genDays","today","filter","includes","index","isoDate","toISO","isAdjacent","isSameMonth","isStart","isSameDay","isEnd","endOfMonth","isSame","formatted","format","isDisabled","isWeekStart","isWeekEnd","isToday","isHidden","isSelected","some","localized","daysInWeek","weekNumbers","getWeek","isAfter","d"],"sources":["../../src/composables/calendar.ts"],"sourcesContent":["// Composables\nimport { useDate } from '@/composables/date/date'\nimport { useProxiedModel } from '@/composables/proxiedModel'\n\n// Utilities\nimport { computed } from 'vue'\nimport { propsFactory, wrapInArray } from '@/util'\n\n// Types\nimport type { PropType } from 'vue'\n\n// Types\nexport interface CalendarProps {\n  allowedDates: unknown[] | ((date: unknown) => boolean) | undefined\n  disabled: boolean\n  displayValue?: unknown\n  modelValue: unknown[] | undefined\n  max: unknown\n  min: unknown\n  showAdjacentMonths: boolean\n  month: number | string | undefined\n  weekdays: number[]\n  year: number | string | undefined\n  weeksInMonth: 'dynamic' | 'static'\n  firstDayOfWeek: number | string | undefined\n\n  'onUpdate:modelValue': ((value: unknown[]) => void) | undefined\n  'onUpdate:month': ((value: number) => void) | undefined\n  'onUpdate:year': ((value: number) => void) | undefined\n}\n\nexport type CalendarWeekdays = 0 | 1 | 2 | 3 | 4 | 5 | 6\n\n// Composables\nexport const makeCalendarProps = propsFactory({\n  allowedDates: [Array, Function] as PropType<unknown[] | ((date: unknown) => boolean)>,\n  disabled: {\n    type: Boolean,\n    default: null,\n  },\n  displayValue: null as any as PropType<unknown>,\n  modelValue: Array as PropType<unknown[]>,\n  month: [Number, String],\n  max: null as any as PropType<unknown>,\n  min: null as any as PropType<unknown>,\n  showAdjacentMonths: Boolean,\n  year: [Number, String],\n  weekdays: {\n    type: Array as PropType<CalendarWeekdays[]>,\n    default: () => [0, 1, 2, 3, 4, 5, 6],\n  },\n  weeksInMonth: {\n    type: String as PropType<'dynamic' | 'static'>,\n    default: 'dynamic',\n  },\n  firstDayOfWeek: {\n    type: [Number, String],\n    default: undefined,\n  },\n}, 'calendar')\n\nexport function useCalendar (props: CalendarProps) {\n  const adapter = useDate()\n  const model = useProxiedModel(\n    props,\n    'modelValue',\n    [],\n    v => wrapInArray(v).map(i => adapter.date(i)),\n  )\n  const displayValue = computed(() => {\n    if (props.displayValue) return adapter.date(props.displayValue)\n    if (model.value.length > 0) return adapter.date(model.value[0])\n    if (props.min) return adapter.date(props.min)\n    if (Array.isArray(props.allowedDates)) return adapter.date(props.allowedDates[0])\n\n    return adapter.date()\n  })\n\n  const year = useProxiedModel(\n    props,\n    'year',\n    undefined,\n    v => {\n      const value = v != null ? Number(v) : adapter.getYear(displayValue.value)\n\n      return adapter.startOfYear(adapter.setYear(adapter.date(), value))\n    },\n    v => adapter.getYear(v)\n  )\n\n  const month = useProxiedModel(\n    props,\n    'month',\n    undefined,\n    v => {\n      const value = v != null ? Number(v) : adapter.getMonth(displayValue.value)\n      const date = adapter.setYear(adapter.startOfMonth(adapter.date()), adapter.getYear(year.value))\n\n      return adapter.setMonth(date, value)\n    },\n    v => adapter.getMonth(v)\n  )\n\n  const weekDays = computed(() => {\n    const firstDayOfWeek = adapter.toJsDate(adapter.startOfWeek(adapter.date(), props.firstDayOfWeek)).getDay()\n    // Always generate all days, regardless of props.weekdays\n    return [0, 1, 2, 3, 4, 5, 6].map(day => (day + firstDayOfWeek) % 7)\n  })\n\n  const weeksInMonth = computed(() => {\n    const weeks = adapter.getWeekArray(month.value, props.firstDayOfWeek)\n\n    const days = weeks.flat()\n\n    // Make sure there's always 6 weeks in month (6 * 7 days)\n    // if weeksInMonth is 'static'\n    const daysInMonth = 6 * 7\n    if (props.weeksInMonth === 'static' && days.length < daysInMonth) {\n      const lastDay = days[days.length - 1]\n\n      let week = []\n      for (let day = 1; day <= daysInMonth - days.length; day++) {\n        week.push(adapter.addDays(lastDay, day))\n\n        if (day % 7 === 0) {\n          weeks.push(week)\n          week = []\n        }\n      }\n    }\n\n    return weeks\n  })\n\n  function genDays (days: unknown[], today: unknown) {\n    return days.filter(date => {\n      return weekDays.value.includes(adapter.toJsDate(date).getDay())\n    }).map((date, index) => {\n      const isoDate = adapter.toISO(date)\n      const isAdjacent = !adapter.isSameMonth(date, month.value)\n      const isStart = adapter.isSameDay(date, adapter.startOfMonth(month.value))\n      const isEnd = adapter.isSameDay(date, adapter.endOfMonth(month.value))\n      const isSame = adapter.isSameDay(date, month.value)\n\n      return {\n        date,\n        isoDate,\n        formatted: adapter.format(date, 'keyboardDate'),\n        year: adapter.getYear(date),\n        month: adapter.getMonth(date),\n        isDisabled: isDisabled(date),\n        isWeekStart: index % 7 === 0,\n        isWeekEnd: index % 7 === 6,\n        isToday: adapter.isSameDay(date, today),\n        isAdjacent,\n        isHidden: isAdjacent && !props.showAdjacentMonths,\n        isStart,\n        isSelected: model.value.some(value => adapter.isSameDay(date, value)),\n        isEnd,\n        isSame,\n        localized: adapter.format(date, 'dayOfMonth'),\n      }\n    })\n  }\n\n  const daysInWeek = computed(() => {\n    const lastDay = adapter.startOfWeek(displayValue.value, props.firstDayOfWeek)\n    const week = []\n    for (let day = 0; day <= 6; day++) {\n      week.push(adapter.addDays(lastDay, day))\n    }\n\n    const today = adapter.date()\n\n    return genDays(week, today)\n  })\n\n  const daysInMonth = computed(() => {\n    const days = weeksInMonth.value.flat()\n    const today = adapter.date() as Date\n\n    return genDays(days, today)\n  })\n\n  const weekNumbers = computed(() => {\n    return weeksInMonth.value.map(week => {\n      return week.length ? adapter.getWeek(week[0], props.firstDayOfWeek) : null\n    })\n  })\n\n  function isDisabled (value: unknown) {\n    if (props.disabled) return true\n\n    const date = adapter.date(value)\n\n    if (props.min && adapter.isAfter(adapter.date(props.min), date)) return true\n    if (props.max && adapter.isAfter(date, adapter.date(props.max))) return true\n\n    if (Array.isArray(props.allowedDates) && props.allowedDates.length > 0) {\n      return !props.allowedDates.some(d => adapter.isSameDay(adapter.date(d), date))\n    }\n\n    if (typeof props.allowedDates === 'function') {\n      return !props.allowedDates(date)\n    }\n\n    return !props.weekdays.includes(adapter.toJsDate(date).getDay())\n  }\n\n  return {\n    displayValue,\n    daysInMonth,\n    daysInWeek,\n    genDays,\n    model,\n    weeksInMonth,\n    weekDays,\n    weekNumbers,\n  }\n}\n"]},"metadata":{},"sourceType":"module"}