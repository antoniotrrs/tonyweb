{"ast":null,"code":"/**\n * WCAG 3.0 APCA perceptual contrast algorithm from https://github.com/Myndex/SAPC-APCA\n * @licence https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document\n * @see https://www.w3.org/WAI/GL/task-forces/silver/wiki/Visual_Contrast_of_Text_Subgroup\n */\n// Types\n// MAGICAL NUMBERS\n// sRGB Conversion to Relative Luminance (Y)\n// Transfer Curve (aka \"Gamma\") for sRGB linearization\n// Simple power curve vs piecewise described in docs\n// Essentially, 2.4 best models actual display\n// characteristics in combination with the total method\nvar mainTRC = 2.4;\nvar Rco = 0.2126729; // sRGB Red Coefficient (from matrix)\n\nvar Gco = 0.7151522; // sRGB Green Coefficient (from matrix)\n\nvar Bco = 0.0721750; // sRGB Blue Coefficient (from matrix)\n// For Finding Raw SAPC Contrast from Relative Luminance (Y)\n// Constants for SAPC Power Curve Exponents\n// One pair for normal text, and one for reverse\n// These are the \"beating heart\" of SAPC\n\nvar normBG = 0.55;\nvar normTXT = 0.58;\nvar revTXT = 0.57;\nvar revBG = 0.62; // For Clamping and Scaling Values\n\nvar blkThrs = 0.03; // Level that triggers the soft black clamp\n\nvar blkClmp = 1.45; // Exponent for the soft black clamp curve\n\nvar deltaYmin = 0.0005; // Lint trap\n\nvar scaleBoW = 1.25; // Scaling for dark text on light\n\nvar scaleWoB = 1.25; // Scaling for light text on dark\n\nvar loConThresh = 0.078; // Threshold for new simple offset scale\n\nvar loConFactor = 12.82051282051282; // = 1/0.078,\n\nvar loConOffset = 0.06; // The simple offset\n\nvar loClip = 0.001; // Output clip (lint trap #2)\n\nexport function APCAcontrast(text, background) {\n  // Linearize sRGB\n  var Rtxt = Math.pow(text.r / 255, mainTRC);\n  var Gtxt = Math.pow(text.g / 255, mainTRC);\n  var Btxt = Math.pow(text.b / 255, mainTRC);\n  var Rbg = Math.pow(background.r / 255, mainTRC);\n  var Gbg = Math.pow(background.g / 255, mainTRC);\n  var Bbg = Math.pow(background.b / 255, mainTRC); // Apply the standard coefficients and sum to Y\n\n  var Ytxt = Rtxt * Rco + Gtxt * Gco + Btxt * Bco;\n  var Ybg = Rbg * Rco + Gbg * Gco + Bbg * Bco; // Soft clamp Y when near black.\n  // Now clamping all colors to prevent crossover errors\n\n  if (Ytxt <= blkThrs) Ytxt += Math.pow(blkThrs - Ytxt, blkClmp);\n  if (Ybg <= blkThrs) Ybg += Math.pow(blkThrs - Ybg, blkClmp); // Return 0 Early for extremely low ∆Y (lint trap #1)\n\n  if (Math.abs(Ybg - Ytxt) < deltaYmin) return 0.0; // SAPC CONTRAST\n\n  var outputContrast; // For weighted final values\n\n  if (Ybg > Ytxt) {\n    // For normal polarity, black text on white\n    // Calculate the SAPC contrast value and scale\n    var SAPC = (Math.pow(Ybg, normBG) - Math.pow(Ytxt, normTXT)) * scaleBoW; // NEW! SAPC SmoothScale™\n    // Low Contrast Smooth Scale Rollout to prevent polarity reversal\n    // and also a low clip for very low contrasts (lint trap #2)\n    // much of this is for very low contrasts, less than 10\n    // therefore for most reversing needs, only loConOffset is important\n\n    outputContrast = SAPC < loClip ? 0.0 : SAPC < loConThresh ? SAPC - SAPC * loConFactor * loConOffset : SAPC - loConOffset;\n  } else {\n    // For reverse polarity, light text on dark\n    // WoB should always return negative value.\n    var _SAPC = (Math.pow(Ybg, revBG) - Math.pow(Ytxt, revTXT)) * scaleWoB;\n\n    outputContrast = _SAPC > -loClip ? 0.0 : _SAPC > -loConThresh ? _SAPC - _SAPC * loConFactor * loConOffset : _SAPC + loConOffset;\n  }\n\n  return outputContrast * 100;\n}","map":{"version":3,"mappings":"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","names":["mainTRC","Rco","Gco","Bco","normBG","normTXT","revTXT","revBG","blkThrs","blkClmp","deltaYmin","scaleBoW","scaleWoB","loConThresh","loConFactor","loConOffset","loClip","APCAcontrast","text","background","Rtxt","r","Gtxt","g","Btxt","b","Rbg","Gbg","Bbg","Ytxt","Ybg","Math","abs","outputContrast","SAPC"],"sources":["../../../src/util/color/APCA.ts"],"sourcesContent":["/**\n * WCAG 3.0 APCA perceptual contrast algorithm from https://github.com/Myndex/SAPC-APCA\n * @licence https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document\n * @see https://www.w3.org/WAI/GL/task-forces/silver/wiki/Visual_Contrast_of_Text_Subgroup\n */\n// Types\nimport type { RGB } from '@/util'\n\n// MAGICAL NUMBERS\n\n// sRGB Conversion to Relative Luminance (Y)\n\n// Transfer Curve (aka \"Gamma\") for sRGB linearization\n// Simple power curve vs piecewise described in docs\n// Essentially, 2.4 best models actual display\n// characteristics in combination with the total method\nconst mainTRC = 2.4\n\nconst Rco = 0.2126729 // sRGB Red Coefficient (from matrix)\nconst Gco = 0.7151522 // sRGB Green Coefficient (from matrix)\nconst Bco = 0.0721750 // sRGB Blue Coefficient (from matrix)\n\n// For Finding Raw SAPC Contrast from Relative Luminance (Y)\n\n// Constants for SAPC Power Curve Exponents\n// One pair for normal text, and one for reverse\n// These are the \"beating heart\" of SAPC\nconst normBG = 0.55\nconst normTXT = 0.58\nconst revTXT = 0.57\nconst revBG = 0.62\n\n// For Clamping and Scaling Values\n\nconst blkThrs = 0.03 // Level that triggers the soft black clamp\nconst blkClmp = 1.45 // Exponent for the soft black clamp curve\nconst deltaYmin = 0.0005 // Lint trap\nconst scaleBoW = 1.25 // Scaling for dark text on light\nconst scaleWoB = 1.25 // Scaling for light text on dark\nconst loConThresh = 0.078 // Threshold for new simple offset scale\nconst loConFactor = 12.82051282051282 // = 1/0.078,\nconst loConOffset = 0.06 // The simple offset\nconst loClip = 0.001 // Output clip (lint trap #2)\n\nexport function APCAcontrast (text: RGB, background: RGB) {\n  // Linearize sRGB\n  const Rtxt = (text.r / 255) ** mainTRC\n  const Gtxt = (text.g / 255) ** mainTRC\n  const Btxt = (text.b / 255) ** mainTRC\n\n  const Rbg = (background.r / 255) ** mainTRC\n  const Gbg = (background.g / 255) ** mainTRC\n  const Bbg = (background.b / 255) ** mainTRC\n\n  // Apply the standard coefficients and sum to Y\n  let Ytxt = (Rtxt * Rco) + (Gtxt * Gco) + (Btxt * Bco)\n  let Ybg = (Rbg * Rco) + (Gbg * Gco) + (Bbg * Bco)\n\n  // Soft clamp Y when near black.\n  // Now clamping all colors to prevent crossover errors\n  if (Ytxt <= blkThrs) Ytxt += (blkThrs - Ytxt) ** blkClmp\n  if (Ybg <= blkThrs) Ybg += (blkThrs - Ybg) ** blkClmp\n\n  // Return 0 Early for extremely low ∆Y (lint trap #1)\n  if (Math.abs(Ybg - Ytxt) < deltaYmin) return 0.0\n\n  // SAPC CONTRAST\n\n  let outputContrast: number // For weighted final values\n  if (Ybg > Ytxt) {\n    // For normal polarity, black text on white\n    // Calculate the SAPC contrast value and scale\n\n    const SAPC = ((Ybg ** normBG) - (Ytxt ** normTXT)) * scaleBoW\n\n    // NEW! SAPC SmoothScale™\n    // Low Contrast Smooth Scale Rollout to prevent polarity reversal\n    // and also a low clip for very low contrasts (lint trap #2)\n    // much of this is for very low contrasts, less than 10\n    // therefore for most reversing needs, only loConOffset is important\n    outputContrast =\n      (SAPC < loClip) ? 0.0\n      : (SAPC < loConThresh) ? SAPC - SAPC * loConFactor * loConOffset\n      : SAPC - loConOffset\n  } else {\n    // For reverse polarity, light text on dark\n    // WoB should always return negative value.\n\n    const SAPC = ((Ybg ** revBG) - (Ytxt ** revTXT)) * scaleWoB\n\n    outputContrast =\n      (SAPC > -loClip) ? 0.0\n      : (SAPC > -loConThresh) ? SAPC - SAPC * loConFactor * loConOffset\n      : SAPC + loConOffset\n  }\n\n  return outputContrast * 100\n}\n"]},"metadata":{},"sourceType":"module"}