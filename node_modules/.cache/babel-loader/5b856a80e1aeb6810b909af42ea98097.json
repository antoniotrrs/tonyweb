{"ast":null,"code":"// Types\nfunction mounted(el, binding) {\n  const modifiers = binding.modifiers || {};\n  const value = binding.value;\n  const {\n    once,\n    immediate,\n    ...modifierKeys\n  } = modifiers;\n  const defaultValue = !Object.keys(modifierKeys).length;\n  const {\n    handler,\n    options\n  } = typeof value === 'object' ? value : {\n    handler: value,\n    options: {\n      attributes: modifierKeys?.attr ?? defaultValue,\n      characterData: modifierKeys?.char ?? defaultValue,\n      childList: modifierKeys?.child ?? defaultValue,\n      subtree: modifierKeys?.sub ?? defaultValue\n    }\n  };\n  const observer = new MutationObserver(function () {\n    let mutations = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    let observer = arguments.length > 1 ? arguments[1] : undefined;\n    handler?.(mutations, observer);\n    if (once) unmounted(el, binding);\n  });\n  if (immediate) handler?.([], observer);\n  el._mutate = Object(el._mutate);\n  el._mutate[binding.instance.$.uid] = {\n    observer\n  };\n  observer.observe(el, options);\n}\n\nfunction unmounted(el, binding) {\n  if (!el._mutate?.[binding.instance.$.uid]) return;\n\n  el._mutate[binding.instance.$.uid].observer.disconnect();\n\n  delete el._mutate[binding.instance.$.uid];\n}\n\nexport const Mutate = {\n  mounted,\n  unmounted\n};\nexport default Mutate;","map":{"version":3,"mappings":"AAAA;AASA,SAASA,OAAT,CAAkBC,EAAlB,EAAmCC,OAAnC,EAAsE;AACpE,QAAMC,SAAS,GAAGD,OAAO,CAACC,SAARD,IAAqB,EAAvC;AACA,QAAME,KAAK,GAAGF,OAAO,CAACE,KAAtB;AACA,QAAM;AAAEC,QAAF;AAAQC,aAAR;AAAmB,OAAGC;AAAtB,MAAuCJ,SAA7C;AACA,QAAMK,YAAY,GAAG,CAACC,MAAM,CAACC,IAAPD,CAAYF,YAAZE,EAA0BE,MAAhD;AAEA,QAAM;AAAEC,WAAF;AAAWC;AAAX,MAAuB,OAAOT,KAAP,KAAiB,QAAjB,GACzBA,KADyB,GAEzB;AACAQ,WAAO,EAAER,KADT;AAEAS,WAAO,EAAE;AACPC,gBAAU,EAAEP,YAAY,EAAEQ,IAAdR,IAAsBC,YAD3B;AAEPQ,mBAAa,EAAET,YAAY,EAAEU,IAAdV,IAAsBC,YAF9B;AAGPU,eAAS,EAAEX,YAAY,EAAEY,KAAdZ,IAAuBC,YAH3B;AAIPY,aAAO,EAAEb,YAAY,EAAEc,GAAdd,IAAqBC;AAJvB;AAFT,GAFJ;AAYA,QAAMc,QAAQ,GAAG,IAAIC,gBAAJ,CAAqB,YAGjC;AAAA,QAFHC,SAA2B,uEAAG,EAE3B;AAF6B,QAChCF,QAA0B,kDADM;AAGhCV,WAAO,GAAGY,SAAH,EAAcF,QAAd,CAAPV;AAEA,QAAIP,IAAJ,EAAUoB,SAAS,CAACxB,EAAD,EAAKC,OAAL,CAATuB;AACX,GAPgB,CAAjB;AASA,MAAInB,SAAJ,EAAeM,OAAO,GAAG,EAAH,EAAOU,QAAP,CAAPV;AAEfX,IAAE,CAACyB,OAAHzB,GAAaQ,MAAM,CAACR,EAAE,CAACyB,OAAJ,CAAnBzB;AACAA,IAAE,CAACyB,OAAHzB,CAAYC,OAAO,CAACyB,QAARzB,CAAkB0B,CAAlB1B,CAAoB2B,GAAhC5B,IAAuC;AAAEqB;AAAF,GAAvCrB;AAEAqB,UAAQ,CAACQ,OAATR,CAAiBrB,EAAjBqB,EAAqBT,OAArBS;AACF;;AAEA,SAASG,SAAT,CAAoBxB,EAApB,EAAqCC,OAArC,EAAwE;AACtE,MAAI,CAACD,EAAE,CAACyB,OAAHzB,GAAaC,OAAO,CAACyB,QAARzB,CAAkB0B,CAAlB1B,CAAoB2B,GAAjC5B,CAAL,EAA4C;;AAE5CA,IAAE,CAACyB,OAAHzB,CAAWC,OAAO,CAACyB,QAARzB,CAAkB0B,CAAlB1B,CAAoB2B,GAA/B5B,EAAqCqB,QAArCrB,CAA8C8B,UAA9C9B;;AACA,SAAOA,EAAE,CAACyB,OAAHzB,CAAWC,OAAO,CAACyB,QAARzB,CAAkB0B,CAAlB1B,CAAoB2B,GAA/B5B,CAAP;AACF;;AAEA,OAAO,MAAM+B,MAAM,GAAG;AACpBhC,SADoB;AAEpByB;AAFoB,CAAf;AAKP,eAAeO,MAAf","names":["mounted","el","binding","modifiers","value","once","immediate","modifierKeys","defaultValue","Object","keys","length","handler","options","attributes","attr","characterData","char","childList","child","subtree","sub","observer","MutationObserver","mutations","unmounted","_mutate","instance","$","uid","observe","disconnect","Mutate"],"sources":["../../../src/directives/mutate/index.ts"],"sourcesContent":["// Types\nimport type { DirectiveBinding } from 'vue'\nimport type { MutationOptions } from '@/composables/mutationObserver'\n\nexport interface MutationDirectiveBinding extends Omit<DirectiveBinding, 'modifiers' | 'value'> {\n  value: MutationCallback | { handler: MutationCallback, options?: MutationObserverInit }\n  modifiers: MutationOptions\n}\n\nfunction mounted (el: HTMLElement, binding: MutationDirectiveBinding) {\n  const modifiers = binding.modifiers || {}\n  const value = binding.value\n  const { once, immediate, ...modifierKeys } = modifiers\n  const defaultValue = !Object.keys(modifierKeys).length\n\n  const { handler, options } = typeof value === 'object'\n    ? value\n    : {\n      handler: value,\n      options: {\n        attributes: modifierKeys?.attr ?? defaultValue,\n        characterData: modifierKeys?.char ?? defaultValue,\n        childList: modifierKeys?.child ?? defaultValue,\n        subtree: modifierKeys?.sub ?? defaultValue,\n      },\n    }\n\n  const observer = new MutationObserver((\n    mutations: MutationRecord[] = [],\n    observer: MutationObserver\n  ) => {\n    handler?.(mutations, observer)\n\n    if (once) unmounted(el, binding)\n  })\n\n  if (immediate) handler?.([], observer)\n\n  el._mutate = Object(el._mutate)\n  el._mutate![binding.instance!.$.uid] = { observer }\n\n  observer.observe(el, options)\n}\n\nfunction unmounted (el: HTMLElement, binding: MutationDirectiveBinding) {\n  if (!el._mutate?.[binding.instance!.$.uid]) return\n\n  el._mutate[binding.instance!.$.uid]!.observer.disconnect()\n  delete el._mutate[binding.instance!.$.uid]\n}\n\nexport const Mutate = {\n  mounted,\n  unmounted,\n}\n\nexport default Mutate\n"]},"metadata":{},"sourceType":"module"}