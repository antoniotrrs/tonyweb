{"ast":null,"code":"import _objectSpread from \"/Users/antoniotorres/Documents/tony/tonyweb/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport \"core-js/modules/es.math.sign.js\";\nimport \"core-js/modules/es.number.constructor.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport { createVNode as _createVNode } from \"vue\"; // Styles\n\nimport \"./VParallax.css\"; // Components\n\nimport { VImg } from \"../VImg/index.js\"; // Composables\n\nimport { useDisplay } from \"../../composables/index.js\";\nimport { makeComponentProps } from \"../../composables/component.js\";\nimport { useIntersectionObserver } from \"../../composables/intersectionObserver.js\";\nimport { useResizeObserver } from \"../../composables/resizeObserver.js\"; // Utilities\n\nimport { computed, onBeforeUnmount, ref, watch, watchEffect } from 'vue';\nimport { clamp, genericComponent, getScrollParent, propsFactory, useRender } from \"../../util/index.js\"; // Types\n\nfunction floor(val) {\n  return Math.floor(Math.abs(val)) * Math.sign(val);\n}\n\nexport var makeVParallaxProps = propsFactory(_objectSpread({\n  scale: {\n    type: [Number, String],\n    default: 0.5\n  }\n}, makeComponentProps()), 'VParallax');\nexport var VParallax = genericComponent()({\n  name: 'VParallax',\n  props: makeVParallaxProps(),\n  setup: function setup(props, _ref) {\n    var slots = _ref.slots;\n\n    var _useIntersectionObser = useIntersectionObserver(),\n        intersectionRef = _useIntersectionObser.intersectionRef,\n        isIntersecting = _useIntersectionObser.isIntersecting;\n\n    var _useResizeObserver = useResizeObserver(),\n        resizeRef = _useResizeObserver.resizeRef,\n        contentRect = _useResizeObserver.contentRect;\n\n    var _useDisplay = useDisplay(),\n        displayHeight = _useDisplay.height;\n\n    var root = ref();\n    watchEffect(function () {\n      var _root$value;\n\n      intersectionRef.value = resizeRef.value = (_root$value = root.value) === null || _root$value === void 0 ? void 0 : _root$value.$el;\n    });\n    var scrollParent;\n    watch(isIntersecting, function (val) {\n      if (val) {\n        scrollParent = getScrollParent(intersectionRef.value);\n        scrollParent = scrollParent === document.scrollingElement ? document : scrollParent;\n        scrollParent.addEventListener('scroll', onScroll, {\n          passive: true\n        });\n        onScroll();\n      } else {\n        scrollParent.removeEventListener('scroll', onScroll);\n      }\n    });\n    onBeforeUnmount(function () {\n      var _scrollParent;\n\n      (_scrollParent = scrollParent) === null || _scrollParent === void 0 ? void 0 : _scrollParent.removeEventListener('scroll', onScroll);\n    });\n    watch(displayHeight, onScroll);\n    watch(function () {\n      var _contentRect$value;\n\n      return (_contentRect$value = contentRect.value) === null || _contentRect$value === void 0 ? void 0 : _contentRect$value.height;\n    }, onScroll);\n    var scale = computed(function () {\n      return 1 - clamp(Number(props.scale));\n    });\n    var frame = -1;\n\n    function onScroll() {\n      if (!isIntersecting.value) return;\n      cancelAnimationFrame(frame);\n      frame = requestAnimationFrame(function () {\n        var _root$value2;\n\n        var el = ((_root$value2 = root.value) === null || _root$value2 === void 0 ? void 0 : _root$value2.$el).querySelector('.v-img__img');\n        if (!el) return;\n        var scrollHeight = scrollParent instanceof Document ? document.documentElement.clientHeight : scrollParent.clientHeight;\n        var scrollPos = scrollParent instanceof Document ? window.scrollY : scrollParent.scrollTop;\n        var top = intersectionRef.value.getBoundingClientRect().top + scrollPos;\n        var height = contentRect.value.height;\n        var center = top + (height - scrollHeight) / 2;\n        var translate = floor((scrollPos - center) * scale.value);\n        var sizeScale = Math.max(1, (scale.value * (scrollHeight - height) + height) / height);\n        el.style.setProperty('transform', \"translateY(\".concat(translate, \"px) scale(\").concat(sizeScale, \")\"));\n      });\n    }\n\n    useRender(function () {\n      return _createVNode(VImg, {\n        \"class\": ['v-parallax', {\n          'v-parallax--active': isIntersecting.value\n        }, props.class],\n        \"style\": props.style,\n        \"ref\": root,\n        \"cover\": true,\n        \"onLoadstart\": onScroll,\n        \"onLoad\": onScroll\n      }, slots);\n    });\n    return {};\n  }\n});","map":{"version":3,"mappings":"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","names":["VImg","useDisplay","makeComponentProps","useIntersectionObserver","useResizeObserver","computed","onBeforeUnmount","ref","watch","watchEffect","clamp","genericComponent","getScrollParent","propsFactory","useRender","floor","val","Math","abs","sign","makeVParallaxProps","scale","type","Number","String","default","VParallax","name","props","setup","_ref","slots","intersectionRef","isIntersecting","resizeRef","contentRect","displayHeight","height","root","value","$el","scrollParent","document","scrollingElement","addEventListener","onScroll","passive","removeEventListener","frame","cancelAnimationFrame","requestAnimationFrame","el","querySelector","scrollHeight","Document","documentElement","clientHeight","scrollPos","window","scrollY","scrollTop","top","getBoundingClientRect","center","translate","sizeScale","max","style","setProperty","class"],"sources":["../../../src/components/VParallax/VParallax.tsx"],"sourcesContent":["// Styles\nimport './VParallax.sass'\n\n// Components\nimport { VImg } from '@/components/VImg'\n\n// Composables\nimport { useDisplay } from '@/composables'\nimport { makeComponentProps } from '@/composables/component'\nimport { useIntersectionObserver } from '@/composables/intersectionObserver'\nimport { useResizeObserver } from '@/composables/resizeObserver'\n\n// Utilities\nimport { computed, onBeforeUnmount, ref, watch, watchEffect } from 'vue'\nimport { clamp, genericComponent, getScrollParent, propsFactory, useRender } from '@/util'\n\n// Types\nimport type { VImgSlots } from '@/components/VImg/VImg'\n\nfunction floor (val: number) {\n  return Math.floor(Math.abs(val)) * Math.sign(val)\n}\n\nexport const makeVParallaxProps = propsFactory({\n  scale: {\n    type: [Number, String],\n    default: 0.5,\n  },\n\n  ...makeComponentProps(),\n}, 'VParallax')\n\nexport const VParallax = genericComponent<VImgSlots>()({\n  name: 'VParallax',\n\n  props: makeVParallaxProps(),\n\n  setup (props, { slots }) {\n    const { intersectionRef, isIntersecting } = useIntersectionObserver()\n    const { resizeRef, contentRect } = useResizeObserver()\n    const { height: displayHeight } = useDisplay()\n\n    const root = ref<VImg>()\n\n    watchEffect(() => {\n      intersectionRef.value = resizeRef.value = root.value?.$el\n    })\n\n    let scrollParent: Element | Document\n    watch(isIntersecting, val => {\n      if (val) {\n        scrollParent = getScrollParent(intersectionRef.value)\n        scrollParent = scrollParent === document.scrollingElement ? document : scrollParent\n        scrollParent.addEventListener('scroll', onScroll, { passive: true })\n        onScroll()\n      } else {\n        scrollParent.removeEventListener('scroll', onScroll)\n      }\n    })\n\n    onBeforeUnmount(() => {\n      scrollParent?.removeEventListener('scroll', onScroll)\n    })\n\n    watch(displayHeight, onScroll)\n    watch(() => contentRect.value?.height, onScroll)\n\n    const scale = computed(() => {\n      return 1 - clamp(Number(props.scale))\n    })\n\n    let frame = -1\n    function onScroll () {\n      if (!isIntersecting.value) return\n\n      cancelAnimationFrame(frame)\n      frame = requestAnimationFrame(() => {\n        const el: HTMLElement | null = (root.value?.$el as Element).querySelector('.v-img__img')\n        if (!el) return\n\n        const scrollHeight = scrollParent instanceof Document ? document.documentElement.clientHeight : scrollParent.clientHeight\n        const scrollPos = scrollParent instanceof Document ? window.scrollY : scrollParent.scrollTop\n        const top = intersectionRef.value!.getBoundingClientRect().top + scrollPos\n        const height = contentRect.value!.height\n\n        const center = top + (height - scrollHeight) / 2\n        const translate = floor((scrollPos - center) * scale.value)\n        const sizeScale = Math.max(1, (scale.value * (scrollHeight - height) + height) / height)\n\n        el.style.setProperty('transform', `translateY(${translate}px) scale(${sizeScale})`)\n      })\n    }\n\n    useRender(() => (\n      <VImg\n        class={[\n          'v-parallax',\n          { 'v-parallax--active': isIntersecting.value },\n          props.class,\n        ]}\n        style={ props.style }\n        ref={ root }\n        cover\n        onLoadstart={ onScroll }\n        onLoad={ onScroll }\n        v-slots={ slots }\n      />\n    ))\n\n    return {}\n  },\n})\n\nexport type VParallax = InstanceType<typeof VParallax>\n"]},"metadata":{},"sourceType":"module"}