{"ast":null,"code":"// Components\nimport { VMenuSymbol } from \"../VMenu/shared.js\"; // Composables\n\nimport { makeDelayProps, useDelay } from \"../../composables/delay.js\"; // Utilities\n\nimport { computed, effectScope, inject, mergeProps, nextTick, onScopeDispose, ref, watch, watchEffect } from 'vue';\nimport { bindProps, getCurrentInstance, IN_BROWSER, matchesSelector, propsFactory, templateRef, unbindProps } from \"../../util/index.js\"; // Types\n\nexport const makeActivatorProps = propsFactory({\n  target: [String, Object],\n  activator: [String, Object],\n  activatorProps: {\n    type: Object,\n    default: () => ({})\n  },\n  openOnClick: {\n    type: Boolean,\n    default: undefined\n  },\n  openOnHover: Boolean,\n  openOnFocus: {\n    type: Boolean,\n    default: undefined\n  },\n  closeOnContentClick: Boolean,\n  ...makeDelayProps()\n}, 'VOverlay-activator');\nexport function useActivator(props, _ref) {\n  let {\n    isActive,\n    isTop,\n    contentEl\n  } = _ref;\n  const vm = getCurrentInstance('useActivator');\n  const activatorEl = ref();\n  let isHovered = false;\n  let isFocused = false;\n  let firstEnter = true;\n  const openOnFocus = computed(() => props.openOnFocus || props.openOnFocus == null && props.openOnHover);\n  const openOnClick = computed(() => props.openOnClick || props.openOnClick == null && !props.openOnHover && !openOnFocus.value);\n  const {\n    runOpenDelay,\n    runCloseDelay\n  } = useDelay(props, value => {\n    if (value === (props.openOnHover && isHovered || openOnFocus.value && isFocused) && !(props.openOnHover && isActive.value && !isTop.value)) {\n      if (isActive.value !== value) {\n        firstEnter = true;\n      }\n\n      isActive.value = value;\n    }\n  });\n  const cursorTarget = ref();\n  const availableEvents = {\n    onClick: e => {\n      e.stopPropagation();\n      activatorEl.value = e.currentTarget || e.target;\n\n      if (!isActive.value) {\n        cursorTarget.value = [e.clientX, e.clientY];\n      }\n\n      isActive.value = !isActive.value;\n    },\n    onMouseenter: e => {\n      if (e.sourceCapabilities?.firesTouchEvents) return;\n      isHovered = true;\n      activatorEl.value = e.currentTarget || e.target;\n      runOpenDelay();\n    },\n    onMouseleave: e => {\n      isHovered = false;\n      runCloseDelay();\n    },\n    onFocus: e => {\n      if (matchesSelector(e.target, ':focus-visible') === false) return;\n      isFocused = true;\n      e.stopPropagation();\n      activatorEl.value = e.currentTarget || e.target;\n      runOpenDelay();\n    },\n    onBlur: e => {\n      isFocused = false;\n      e.stopPropagation();\n      runCloseDelay();\n    }\n  };\n  const activatorEvents = computed(() => {\n    const events = {};\n\n    if (openOnClick.value) {\n      events.onClick = availableEvents.onClick;\n    }\n\n    if (props.openOnHover) {\n      events.onMouseenter = availableEvents.onMouseenter;\n      events.onMouseleave = availableEvents.onMouseleave;\n    }\n\n    if (openOnFocus.value) {\n      events.onFocus = availableEvents.onFocus;\n      events.onBlur = availableEvents.onBlur;\n    }\n\n    return events;\n  });\n  const contentEvents = computed(() => {\n    const events = {};\n\n    if (props.openOnHover) {\n      events.onMouseenter = () => {\n        isHovered = true;\n        runOpenDelay();\n      };\n\n      events.onMouseleave = () => {\n        isHovered = false;\n        runCloseDelay();\n      };\n    }\n\n    if (openOnFocus.value) {\n      events.onFocusin = () => {\n        isFocused = true;\n        runOpenDelay();\n      };\n\n      events.onFocusout = () => {\n        isFocused = false;\n        runCloseDelay();\n      };\n    }\n\n    if (props.closeOnContentClick) {\n      const menu = inject(VMenuSymbol, null);\n\n      events.onClick = () => {\n        isActive.value = false;\n        menu?.closeParents();\n      };\n    }\n\n    return events;\n  });\n  const scrimEvents = computed(() => {\n    const events = {};\n\n    if (props.openOnHover) {\n      events.onMouseenter = () => {\n        if (firstEnter) {\n          isHovered = true;\n          firstEnter = false;\n          runOpenDelay();\n        }\n      };\n\n      events.onMouseleave = () => {\n        isHovered = false;\n        runCloseDelay();\n      };\n    }\n\n    return events;\n  });\n  watch(isTop, val => {\n    if (val && (props.openOnHover && !isHovered && (!openOnFocus.value || !isFocused) || openOnFocus.value && !isFocused && (!props.openOnHover || !isHovered)) && !contentEl.value?.contains(document.activeElement)) {\n      isActive.value = false;\n    }\n  });\n  watch(isActive, val => {\n    if (!val) {\n      setTimeout(() => {\n        cursorTarget.value = undefined;\n      });\n    }\n  }, {\n    flush: 'post'\n  });\n  const activatorRef = templateRef();\n  watchEffect(() => {\n    if (!activatorRef.value) return;\n    nextTick(() => {\n      activatorEl.value = activatorRef.el;\n    });\n  });\n  const targetRef = templateRef();\n  const target = computed(() => {\n    if (props.target === 'cursor' && cursorTarget.value) return cursorTarget.value;\n    if (targetRef.value) return targetRef.el;\n    return getTarget(props.target, vm) || activatorEl.value;\n  });\n  const targetEl = computed(() => {\n    return Array.isArray(target.value) ? undefined : target.value;\n  });\n  let scope;\n  watch(() => !!props.activator, val => {\n    if (val && IN_BROWSER) {\n      scope = effectScope();\n      scope.run(() => {\n        _useActivator(props, vm, {\n          activatorEl,\n          activatorEvents\n        });\n      });\n    } else if (scope) {\n      scope.stop();\n    }\n  }, {\n    flush: 'post',\n    immediate: true\n  });\n  onScopeDispose(() => {\n    scope?.stop();\n  });\n  return {\n    activatorEl,\n    activatorRef,\n    target,\n    targetEl,\n    targetRef,\n    activatorEvents,\n    contentEvents,\n    scrimEvents\n  };\n}\n\nfunction _useActivator(props, vm, _ref2) {\n  let {\n    activatorEl,\n    activatorEvents\n  } = _ref2;\n  watch(() => props.activator, (val, oldVal) => {\n    if (oldVal && val !== oldVal) {\n      const activator = getActivator(oldVal);\n      activator && unbindActivatorProps(activator);\n    }\n\n    if (val) {\n      nextTick(() => bindActivatorProps());\n    }\n  }, {\n    immediate: true\n  });\n  watch(() => props.activatorProps, () => {\n    bindActivatorProps();\n  });\n  onScopeDispose(() => {\n    unbindActivatorProps();\n  });\n\n  function bindActivatorProps() {\n    let el = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : getActivator();\n\n    let _props = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : props.activatorProps;\n\n    if (!el) return;\n    bindProps(el, mergeProps(activatorEvents.value, _props));\n  }\n\n  function unbindActivatorProps() {\n    let el = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : getActivator();\n\n    let _props = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : props.activatorProps;\n\n    if (!el) return;\n    unbindProps(el, mergeProps(activatorEvents.value, _props));\n  }\n\n  function getActivator() {\n    let selector = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : props.activator;\n    const activator = getTarget(selector, vm); // The activator should only be a valid element (Ignore comments and text nodes)\n\n    activatorEl.value = activator?.nodeType === Node.ELEMENT_NODE ? activator : undefined;\n    return activatorEl.value;\n  }\n}\n\nfunction getTarget(selector, vm) {\n  if (!selector) return;\n  let target;\n\n  if (selector === 'parent') {\n    let el = vm?.proxy?.$el?.parentNode;\n\n    while (el?.hasAttribute('data-no-activator')) {\n      el = el.parentNode;\n    }\n\n    target = el;\n  } else if (typeof selector === 'string') {\n    // Selector\n    target = document.querySelector(selector);\n  } else if ('$el' in selector) {\n    // Component (ref)\n    target = selector.$el;\n  } else {\n    // HTMLElement | Element | [x, y]\n    target = selector;\n  }\n\n  return target;\n}","map":{"version":3,"mappings":"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","names":["VMenuSymbol","makeDelayProps","useDelay","computed","effectScope","inject","mergeProps","nextTick","onScopeDispose","ref","watch","watchEffect","bindProps","getCurrentInstance","IN_BROWSER","matchesSelector","propsFactory","templateRef","unbindProps","makeActivatorProps","target","String","Object","activator","activatorProps","type","default","openOnClick","Boolean","undefined","openOnHover","openOnFocus","closeOnContentClick","useActivator","props","_ref","isActive","isTop","contentEl","vm","activatorEl","isHovered","isFocused","firstEnter","value","runOpenDelay","runCloseDelay","cursorTarget","availableEvents","onClick","e","stopPropagation","currentTarget","clientX","clientY","onMouseenter","sourceCapabilities","firesTouchEvents","onMouseleave","onFocus","onBlur","activatorEvents","events","contentEvents","onFocusin","onFocusout","menu","closeParents","scrimEvents","val","contains","document","activeElement","setTimeout","flush","activatorRef","el","targetRef","getTarget","targetEl","Array","isArray","scope","run","_useActivator","stop","immediate","_ref2","oldVal","getActivator","unbindActivatorProps","bindActivatorProps","_props","selector","nodeType","Node","ELEMENT_NODE","proxy","$el","parentNode","hasAttribute","querySelector"],"sources":["../../../src/components/VOverlay/useActivator.tsx"],"sourcesContent":["// Components\nimport { VMenuSymbol } from '@/components/VMenu/shared'\n\n// Composables\nimport { makeDelayProps, useDelay } from '@/composables/delay'\n\n// Utilities\nimport {\n  computed,\n  effectScope,\n  inject,\n  mergeProps,\n  nextTick,\n  onScopeDispose,\n  ref,\n  watch,\n  watchEffect,\n} from 'vue'\nimport {\n  bindProps,\n  getCurrentInstance,\n  IN_BROWSER,\n  matchesSelector,\n  propsFactory,\n  templateRef,\n  unbindProps,\n} from '@/util'\n\n// Types\nimport type {\n  ComponentInternalInstance,\n  ComponentPublicInstance,\n  EffectScope,\n  PropType,\n  Ref,\n} from 'vue'\nimport type { DelayProps } from '@/composables/delay'\n\ninterface ActivatorProps extends DelayProps {\n  target: 'parent' | 'cursor' | (string & {}) | Element | ComponentPublicInstance | [x: number, y: number] | undefined\n  activator: 'parent' | (string & {}) | Element | ComponentPublicInstance | undefined\n  activatorProps: Record<string, any>\n\n  openOnClick: boolean | undefined\n  openOnHover: boolean\n  openOnFocus: boolean | undefined\n\n  closeOnContentClick: boolean\n}\n\nexport const makeActivatorProps = propsFactory({\n  target: [String, Object] as PropType<ActivatorProps['target']>,\n  activator: [String, Object] as PropType<ActivatorProps['activator']>,\n  activatorProps: {\n    type: Object as PropType<ActivatorProps['activatorProps']>,\n    default: () => ({}),\n  },\n\n  openOnClick: {\n    type: Boolean,\n    default: undefined,\n  },\n  openOnHover: Boolean,\n  openOnFocus: {\n    type: Boolean,\n    default: undefined,\n  },\n\n  closeOnContentClick: Boolean,\n\n  ...makeDelayProps(),\n}, 'VOverlay-activator')\n\nexport function useActivator (\n  props: ActivatorProps,\n  { isActive, isTop, contentEl }: {\n    isActive: Ref<boolean>\n    isTop: Ref<boolean>\n    contentEl: Ref<HTMLElement | undefined>\n  }\n) {\n  const vm = getCurrentInstance('useActivator')\n  const activatorEl = ref<HTMLElement>()\n\n  let isHovered = false\n  let isFocused = false\n  let firstEnter = true\n\n  const openOnFocus = computed(() => props.openOnFocus || (props.openOnFocus == null && props.openOnHover))\n  const openOnClick = computed(() => props.openOnClick || (props.openOnClick == null && !props.openOnHover && !openOnFocus.value))\n\n  const { runOpenDelay, runCloseDelay } = useDelay(props, value => {\n    if (\n      value === (\n        (props.openOnHover && isHovered) ||\n        (openOnFocus.value && isFocused)\n      ) && !(props.openOnHover && isActive.value && !isTop.value)\n    ) {\n      if (isActive.value !== value) {\n        firstEnter = true\n      }\n      isActive.value = value\n    }\n  })\n\n  const cursorTarget = ref<[x: number, y: number]>()\n  const availableEvents = {\n    onClick: (e: MouseEvent) => {\n      e.stopPropagation()\n      activatorEl.value = (e.currentTarget || e.target) as HTMLElement\n      if (!isActive.value) {\n        cursorTarget.value = [e.clientX, e.clientY]\n      }\n      isActive.value = !isActive.value\n    },\n    onMouseenter: (e: MouseEvent) => {\n      if (e.sourceCapabilities?.firesTouchEvents) return\n\n      isHovered = true\n      activatorEl.value = (e.currentTarget || e.target) as HTMLElement\n      runOpenDelay()\n    },\n    onMouseleave: (e: MouseEvent) => {\n      isHovered = false\n      runCloseDelay()\n    },\n    onFocus: (e: FocusEvent) => {\n      if (matchesSelector(e.target as HTMLElement, ':focus-visible') === false) return\n\n      isFocused = true\n      e.stopPropagation()\n      activatorEl.value = (e.currentTarget || e.target) as HTMLElement\n\n      runOpenDelay()\n    },\n    onBlur: (e: FocusEvent) => {\n      isFocused = false\n      e.stopPropagation()\n\n      runCloseDelay()\n    },\n  }\n\n  const activatorEvents = computed(() => {\n    const events: Partial<typeof availableEvents> = {}\n\n    if (openOnClick.value) {\n      events.onClick = availableEvents.onClick\n    }\n    if (props.openOnHover) {\n      events.onMouseenter = availableEvents.onMouseenter\n      events.onMouseleave = availableEvents.onMouseleave\n    }\n    if (openOnFocus.value) {\n      events.onFocus = availableEvents.onFocus\n      events.onBlur = availableEvents.onBlur\n    }\n\n    return events\n  })\n\n  const contentEvents = computed(() => {\n    const events: Record<string, EventListener> = {}\n\n    if (props.openOnHover) {\n      events.onMouseenter = () => {\n        isHovered = true\n        runOpenDelay()\n      }\n      events.onMouseleave = () => {\n        isHovered = false\n        runCloseDelay()\n      }\n    }\n\n    if (openOnFocus.value) {\n      events.onFocusin = () => {\n        isFocused = true\n        runOpenDelay()\n      }\n      events.onFocusout = () => {\n        isFocused = false\n        runCloseDelay()\n      }\n    }\n\n    if (props.closeOnContentClick) {\n      const menu = inject(VMenuSymbol, null)\n      events.onClick = () => {\n        isActive.value = false\n        menu?.closeParents()\n      }\n    }\n\n    return events\n  })\n\n  const scrimEvents = computed(() => {\n    const events: Record<string, EventListener> = {}\n\n    if (props.openOnHover) {\n      events.onMouseenter = () => {\n        if (firstEnter) {\n          isHovered = true\n          firstEnter = false\n          runOpenDelay()\n        }\n      }\n      events.onMouseleave = () => {\n        isHovered = false\n        runCloseDelay()\n      }\n    }\n\n    return events\n  })\n\n  watch(isTop, val => {\n    if (val && (\n      (props.openOnHover && !isHovered && (!openOnFocus.value || !isFocused)) ||\n      (openOnFocus.value && !isFocused && (!props.openOnHover || !isHovered))\n    ) && !contentEl.value?.contains(document.activeElement)) {\n      isActive.value = false\n    }\n  })\n\n  watch(isActive, val => {\n    if (!val) {\n      setTimeout(() => {\n        cursorTarget.value = undefined\n      })\n    }\n  }, { flush: 'post' })\n\n  const activatorRef = templateRef()\n  watchEffect(() => {\n    if (!activatorRef.value) return\n\n    nextTick(() => {\n      activatorEl.value = activatorRef.el\n    })\n  })\n\n  const targetRef = templateRef()\n  const target = computed(() => {\n    if (props.target === 'cursor' && cursorTarget.value) return cursorTarget.value\n    if (targetRef.value) return targetRef.el\n    return getTarget(props.target, vm) || activatorEl.value\n  })\n  const targetEl = computed(() => {\n    return Array.isArray(target.value)\n      ? undefined\n      : target.value\n  })\n\n  let scope: EffectScope\n  watch(() => !!props.activator, val => {\n    if (val && IN_BROWSER) {\n      scope = effectScope()\n      scope.run(() => {\n        _useActivator(props, vm, { activatorEl, activatorEvents })\n      })\n    } else if (scope) {\n      scope.stop()\n    }\n  }, { flush: 'post', immediate: true })\n\n  onScopeDispose(() => {\n    scope?.stop()\n  })\n\n  return { activatorEl, activatorRef, target, targetEl, targetRef, activatorEvents, contentEvents, scrimEvents }\n}\n\nfunction _useActivator (\n  props: ActivatorProps,\n  vm: ComponentInternalInstance,\n  { activatorEl, activatorEvents }: Pick<ReturnType<typeof useActivator>, 'activatorEl' | 'activatorEvents'>\n) {\n  watch(() => props.activator, (val, oldVal) => {\n    if (oldVal && val !== oldVal) {\n      const activator = getActivator(oldVal)\n      activator && unbindActivatorProps(activator)\n    }\n    if (val) {\n      nextTick(() => bindActivatorProps())\n    }\n  }, { immediate: true })\n\n  watch(() => props.activatorProps, () => {\n    bindActivatorProps()\n  })\n\n  onScopeDispose(() => {\n    unbindActivatorProps()\n  })\n\n  function bindActivatorProps (el = getActivator(), _props = props.activatorProps) {\n    if (!el) return\n\n    bindProps(el, mergeProps(activatorEvents.value, _props))\n  }\n\n  function unbindActivatorProps (el = getActivator(), _props = props.activatorProps) {\n    if (!el) return\n\n    unbindProps(el, mergeProps(activatorEvents.value, _props))\n  }\n\n  function getActivator (selector = props.activator): HTMLElement | undefined {\n    const activator = getTarget(selector, vm)\n\n    // The activator should only be a valid element (Ignore comments and text nodes)\n    activatorEl.value = activator?.nodeType === Node.ELEMENT_NODE ? activator : undefined\n\n    return activatorEl.value\n  }\n}\n\nfunction getTarget<T extends 'parent' | string | Element | ComponentPublicInstance | [x: number, y: number] | undefined> (\n  selector: T,\n  vm: ComponentInternalInstance\n): HTMLElement | undefined | (T extends any[] ? [x: number, y: number] : never) {\n  if (!selector) return\n\n  let target\n  if (selector === 'parent') {\n    let el = vm?.proxy?.$el?.parentNode\n    while (el?.hasAttribute('data-no-activator')) {\n      el = el.parentNode\n    }\n    target = el\n  } else if (typeof selector === 'string') {\n    // Selector\n    target = document.querySelector(selector)\n  } else if ('$el' in selector) {\n    // Component (ref)\n    target = selector.$el\n  } else {\n    // HTMLElement | Element | [x, y]\n    target = selector\n  }\n\n  return target\n}\n"]},"metadata":{},"sourceType":"module"}