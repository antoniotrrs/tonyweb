{"ast":null,"code":"import _objectSpread from \"/Users/antoniotorres/Documents/tony/tonyweb/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\n// Utilities\nimport { computed, nextTick, onScopeDispose, reactive, resolveDynamicComponent, toRef } from 'vue';\nimport { deepEqual, getCurrentInstance, hasEvent, IN_BROWSER, propsFactory } from \"../util/index.js\"; // Types\n\nexport function useRoute() {\n  var vm = getCurrentInstance('useRoute');\n  return computed(function () {\n    var _vm$proxy;\n\n    return vm === null || vm === void 0 ? void 0 : (_vm$proxy = vm.proxy) === null || _vm$proxy === void 0 ? void 0 : _vm$proxy.$route;\n  });\n}\nexport function useRouter() {\n  var _getCurrentInstance, _getCurrentInstance$p;\n\n  return (_getCurrentInstance = getCurrentInstance('useRouter')) === null || _getCurrentInstance === void 0 ? void 0 : (_getCurrentInstance$p = _getCurrentInstance.proxy) === null || _getCurrentInstance$p === void 0 ? void 0 : _getCurrentInstance$p.$router;\n}\nexport function useLink(props, attrs) {\n  var _link$value2, _link$value3;\n\n  var RouterLink = resolveDynamicComponent('RouterLink');\n  var isLink = computed(function () {\n    return !!(props.href || props.to);\n  });\n  var isClickable = computed(function () {\n    return (isLink === null || isLink === void 0 ? void 0 : isLink.value) || hasEvent(attrs, 'click') || hasEvent(props, 'click');\n  });\n\n  if (typeof RouterLink === 'string' || !('useLink' in RouterLink)) {\n    var _href = toRef(props, 'href');\n\n    return {\n      isLink: isLink,\n      isClickable: isClickable,\n      href: _href,\n      linkProps: reactive({\n        href: _href\n      })\n    };\n  } // vue-router useLink `to` prop needs to be reactive and useLink will crash if undefined\n\n\n  var linkProps = computed(function () {\n    return _objectSpread(_objectSpread({}, props), {}, {\n      to: toRef(function () {\n        return props.to || '';\n      })\n    });\n  });\n  var routerLink = RouterLink.useLink(linkProps.value); // Actual link needs to be undefined when to prop is not used\n\n  var link = computed(function () {\n    return props.to ? routerLink : undefined;\n  });\n  var route = useRoute();\n  var isActive = computed(function () {\n    var _link$value$isActive$, _link$value$isActive, _link$value$isExactAc, _link$value$isExactAc2, _link$value$isExactAc3;\n\n    if (!link.value) return false;\n    if (!props.exact) return (_link$value$isActive$ = (_link$value$isActive = link.value.isActive) === null || _link$value$isActive === void 0 ? void 0 : _link$value$isActive.value) !== null && _link$value$isActive$ !== void 0 ? _link$value$isActive$ : false;\n    if (!route.value) return (_link$value$isExactAc = (_link$value$isExactAc2 = link.value.isExactActive) === null || _link$value$isExactAc2 === void 0 ? void 0 : _link$value$isExactAc2.value) !== null && _link$value$isExactAc !== void 0 ? _link$value$isExactAc : false;\n    return ((_link$value$isExactAc3 = link.value.isExactActive) === null || _link$value$isExactAc3 === void 0 ? void 0 : _link$value$isExactAc3.value) && deepEqual(link.value.route.value.query, route.value.query);\n  });\n  var href = computed(function () {\n    var _link$value;\n\n    return props.to ? (_link$value = link.value) === null || _link$value === void 0 ? void 0 : _link$value.route.value.href : props.href;\n  });\n  return {\n    isLink: isLink,\n    isClickable: isClickable,\n    isActive: isActive,\n    route: (_link$value2 = link.value) === null || _link$value2 === void 0 ? void 0 : _link$value2.route,\n    navigate: (_link$value3 = link.value) === null || _link$value3 === void 0 ? void 0 : _link$value3.navigate,\n    href: href,\n    linkProps: reactive({\n      href: href,\n      'aria-current': computed(function () {\n        return isActive.value ? 'page' : undefined;\n      })\n    })\n  };\n}\nexport var makeRouterProps = propsFactory({\n  href: String,\n  replace: Boolean,\n  to: [String, Object],\n  exact: Boolean\n}, 'router');\nvar inTransition = false;\nexport function useBackButton(router, cb) {\n  var popped = false;\n  var removeBefore;\n  var removeAfter;\n\n  if (IN_BROWSER && router !== null && router !== void 0 && router.beforeEach) {\n    nextTick(function () {\n      window.addEventListener('popstate', onPopstate);\n      removeBefore = router.beforeEach(function (to, from, next) {\n        if (!inTransition) {\n          setTimeout(function () {\n            return popped ? cb(next) : next();\n          });\n        } else {\n          popped ? cb(next) : next();\n        }\n\n        inTransition = true;\n      });\n      removeAfter = router === null || router === void 0 ? void 0 : router.afterEach(function () {\n        inTransition = false;\n      });\n    });\n    onScopeDispose(function () {\n      var _removeBefore, _removeAfter;\n\n      window.removeEventListener('popstate', onPopstate);\n      (_removeBefore = removeBefore) === null || _removeBefore === void 0 ? void 0 : _removeBefore();\n      (_removeAfter = removeAfter) === null || _removeAfter === void 0 ? void 0 : _removeAfter();\n    });\n  }\n\n  function onPopstate(e) {\n    var _e$state;\n\n    if ((_e$state = e.state) !== null && _e$state !== void 0 && _e$state.replaced) return;\n    popped = true;\n    setTimeout(function () {\n      return popped = false;\n    });\n  }\n}","map":{"version":3,"mappings":"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","names":["computed","nextTick","onScopeDispose","reactive","resolveDynamicComponent","toRef","deepEqual","getCurrentInstance","hasEvent","IN_BROWSER","propsFactory","useRoute","vm","proxy","$route","useRouter","$router","useLink","props","attrs","RouterLink","isLink","href","to","isClickable","value","linkProps","routerLink","link","undefined","route","isActive","exact","isExactActive","query","navigate","makeRouterProps","String","replace","Boolean","Object","inTransition","useBackButton","router","cb","popped","removeBefore","removeAfter","beforeEach","window","addEventListener","onPopstate","from","next","setTimeout","afterEach","removeEventListener","e","state","replaced"],"sources":["../../src/composables/router.tsx"],"sourcesContent":["// Utilities\nimport {\n  computed,\n  nextTick,\n  onScopeDispose, reactive,\n  resolveDynamicComponent,\n  toRef,\n} from 'vue'\nimport { deepEqual, getCurrentInstance, hasEvent, IN_BROWSER, propsFactory } from '@/util'\n\n// Types\nimport type { ComputedRef, PropType, Ref, SetupContext } from 'vue'\nimport type {\n  RouterLink as _RouterLink,\n  useLink as _useLink,\n  NavigationGuardNext,\n  RouteLocationNormalizedLoaded,\n  RouteLocationRaw,\n  Router,\n  UseLinkOptions,\n} from 'vue-router'\nimport type { EventProp } from '@/util'\n\nexport function useRoute (): Ref<RouteLocationNormalizedLoaded | undefined> {\n  const vm = getCurrentInstance('useRoute')\n\n  return computed(() => vm?.proxy?.$route)\n}\n\nexport function useRouter (): Router | undefined {\n  return getCurrentInstance('useRouter')?.proxy?.$router\n}\n\nexport interface LinkProps {\n  href: string | undefined\n  replace: boolean | undefined\n  to: RouteLocationRaw | undefined\n  exact: boolean | undefined\n}\n\nexport interface LinkListeners {\n  onClick?: EventProp | undefined\n  onClickOnce?: EventProp | undefined\n}\n\nexport interface UseLink extends Omit<Partial<ReturnType<typeof _useLink>>, 'href'> {\n  isLink: ComputedRef<boolean>\n  isClickable: ComputedRef<boolean>\n  href: Ref<string | undefined>\n  linkProps: Record<string, string | undefined>\n}\n\nexport function useLink (props: LinkProps & LinkListeners, attrs: SetupContext['attrs']): UseLink {\n  const RouterLink = resolveDynamicComponent('RouterLink') as typeof _RouterLink | string\n\n  const isLink = computed(() => !!(props.href || props.to))\n  const isClickable = computed(() => {\n    return isLink?.value || hasEvent(attrs, 'click') || hasEvent(props, 'click')\n  })\n\n  if (typeof RouterLink === 'string' || !('useLink' in RouterLink)) {\n    const href = toRef(props, 'href')\n    return {\n      isLink,\n      isClickable,\n      href,\n      linkProps: reactive({ href }),\n    }\n  }\n  // vue-router useLink `to` prop needs to be reactive and useLink will crash if undefined\n  const linkProps = computed(() => ({\n    ...props,\n    to: toRef(() => props.to || ''),\n  }))\n\n  const routerLink = RouterLink.useLink(linkProps.value as UseLinkOptions)\n  // Actual link needs to be undefined when to prop is not used\n  const link = computed(() => props.to ? routerLink : undefined)\n  const route = useRoute()\n  const isActive = computed(() => {\n    if (!link.value) return false\n    if (!props.exact) return link.value.isActive?.value ?? false\n    if (!route.value) return link.value.isExactActive?.value ?? false\n\n    return link.value.isExactActive?.value && deepEqual(link.value.route.value.query, route.value.query)\n  })\n  const href = computed(() => props.to ? link.value?.route.value.href : props.href)\n\n  return {\n    isLink,\n    isClickable,\n    isActive,\n    route: link.value?.route,\n    navigate: link.value?.navigate,\n    href,\n    linkProps: reactive({\n      href,\n      'aria-current': computed(() => isActive.value ? 'page' : undefined),\n    }),\n  }\n}\n\nexport const makeRouterProps = propsFactory({\n  href: String,\n  replace: Boolean,\n  to: [String, Object] as PropType<RouteLocationRaw>,\n  exact: Boolean,\n}, 'router')\n\nlet inTransition = false\nexport function useBackButton (router: Router | undefined, cb: (next: NavigationGuardNext) => void) {\n  let popped = false\n  let removeBefore: (() => void) | undefined\n  let removeAfter: (() => void) | undefined\n\n  if (IN_BROWSER && router?.beforeEach) {\n    nextTick(() => {\n      window.addEventListener('popstate', onPopstate)\n      removeBefore = router.beforeEach((to, from, next) => {\n        if (!inTransition) {\n          setTimeout(() => popped ? cb(next) : next())\n        } else {\n          popped ? cb(next) : next()\n        }\n        inTransition = true\n      })\n      removeAfter = router?.afterEach(() => {\n        inTransition = false\n      })\n    })\n    onScopeDispose(() => {\n      window.removeEventListener('popstate', onPopstate)\n      removeBefore?.()\n      removeAfter?.()\n    })\n  }\n\n  function onPopstate (e: PopStateEvent) {\n    if (e.state?.replaced) return\n\n    popped = true\n    setTimeout(() => (popped = false))\n  }\n}\n"]},"metadata":{},"sourceType":"module"}