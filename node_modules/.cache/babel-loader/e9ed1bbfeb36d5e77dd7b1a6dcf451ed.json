{"ast":null,"code":"import _typeof from \"/Users/antoniotorres/Documents/tony/tonyweb/node_modules/@babel/runtime/helpers/esm/typeof.js\";\nimport _objectSpread from \"/Users/antoniotorres/Documents/tony/tonyweb/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport \"core-js/modules/es.number.constructor.js\";\nimport \"core-js/modules/es.string.ends-with.js\";\nimport \"core-js/modules/es.string.starts-with.js\";\nimport { createVNode as _createVNode, Fragment as _Fragment, resolveDirective as _resolveDirective, mergeProps as _mergeProps, withDirectives as _withDirectives } from \"vue\"; // Styles\n\nimport \"./VImg.css\"; // Components\n\nimport { makeVResponsiveProps, VResponsive } from \"../VResponsive/VResponsive.js\"; // Composables\n\nimport { useBackgroundColor } from \"../../composables/color.js\";\nimport { makeComponentProps } from \"../../composables/component.js\";\nimport { makeRoundedProps, useRounded } from \"../../composables/rounded.js\";\nimport { makeTransitionProps, MaybeTransition } from \"../../composables/transition.js\"; // Directives\n\nimport intersect from \"../../directives/intersect/index.js\"; // Utilities\n\nimport { computed, nextTick, onBeforeMount, onBeforeUnmount, ref, shallowRef, toRef, vShow, watch, withDirectives } from 'vue';\nimport { convertToUnit, genericComponent, getCurrentInstance, propsFactory, SUPPORTS_INTERSECTION, useRender } from \"../../util/index.js\"; // Types\n// not intended for public use, this is passed in by vuetify-loader\n\nexport var makeVImgProps = propsFactory(_objectSpread(_objectSpread(_objectSpread(_objectSpread({\n  absolute: Boolean,\n  alt: String,\n  cover: Boolean,\n  color: String,\n  draggable: {\n    type: [Boolean, String],\n    default: undefined\n  },\n  eager: Boolean,\n  gradient: String,\n  lazySrc: String,\n  options: {\n    type: Object,\n    // For more information on types, navigate to:\n    // https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API\n    default: function _default() {\n      return {\n        root: undefined,\n        rootMargin: undefined,\n        threshold: undefined\n      };\n    }\n  },\n  sizes: String,\n  src: {\n    type: [String, Object],\n    default: ''\n  },\n  crossorigin: String,\n  referrerpolicy: String,\n  srcset: String,\n  position: String\n}, makeVResponsiveProps()), makeComponentProps()), makeRoundedProps()), makeTransitionProps()), 'VImg');\nexport var VImg = genericComponent()({\n  name: 'VImg',\n  directives: {\n    intersect: intersect\n  },\n  props: makeVImgProps(),\n  emits: {\n    loadstart: function loadstart(value) {\n      return true;\n    },\n    load: function load(value) {\n      return true;\n    },\n    error: function error(value) {\n      return true;\n    }\n  },\n  setup: function setup(props, _ref) {\n    var emit = _ref.emit,\n        slots = _ref.slots;\n\n    var _useBackgroundColor = useBackgroundColor(toRef(props, 'color')),\n        backgroundColorClasses = _useBackgroundColor.backgroundColorClasses,\n        backgroundColorStyles = _useBackgroundColor.backgroundColorStyles;\n\n    var _useRounded = useRounded(props),\n        roundedClasses = _useRounded.roundedClasses;\n\n    var vm = getCurrentInstance('VImg');\n    var currentSrc = shallowRef(''); // Set from srcset\n\n    var image = ref();\n    var state = shallowRef(props.eager ? 'loading' : 'idle');\n    var naturalWidth = shallowRef();\n    var naturalHeight = shallowRef();\n    var normalisedSrc = computed(function () {\n      return props.src && _typeof(props.src) === 'object' ? {\n        src: props.src.src,\n        srcset: props.srcset || props.src.srcset,\n        lazySrc: props.lazySrc || props.src.lazySrc,\n        aspect: Number(props.aspectRatio || props.src.aspect || 0)\n      } : {\n        src: props.src,\n        srcset: props.srcset,\n        lazySrc: props.lazySrc,\n        aspect: Number(props.aspectRatio || 0)\n      };\n    });\n    var aspectRatio = computed(function () {\n      return normalisedSrc.value.aspect || naturalWidth.value / naturalHeight.value || 0;\n    });\n    watch(function () {\n      return props.src;\n    }, function () {\n      init(state.value !== 'idle');\n    });\n    watch(aspectRatio, function (val, oldVal) {\n      if (!val && oldVal && image.value) {\n        pollForSize(image.value);\n      }\n    }); // TODO: getSrc when window width changes\n\n    onBeforeMount(function () {\n      return init();\n    });\n\n    function init(isIntersecting) {\n      if (props.eager && isIntersecting) return;\n      if (SUPPORTS_INTERSECTION && !isIntersecting && !props.eager) return;\n      state.value = 'loading';\n\n      if (normalisedSrc.value.lazySrc) {\n        var lazyImg = new Image();\n        lazyImg.src = normalisedSrc.value.lazySrc;\n        pollForSize(lazyImg, null);\n      }\n\n      if (!normalisedSrc.value.src) return;\n      nextTick(function () {\n        var _image$value;\n\n        emit('loadstart', ((_image$value = image.value) === null || _image$value === void 0 ? void 0 : _image$value.currentSrc) || normalisedSrc.value.src);\n        setTimeout(function () {\n          var _image$value2;\n\n          if (vm.isUnmounted) return;\n\n          if ((_image$value2 = image.value) !== null && _image$value2 !== void 0 && _image$value2.complete) {\n            if (!image.value.naturalWidth) {\n              onError();\n            }\n\n            if (state.value === 'error') return;\n            if (!aspectRatio.value) pollForSize(image.value, null);\n            if (state.value === 'loading') onLoad();\n          } else {\n            if (!aspectRatio.value) pollForSize(image.value);\n            getSrc();\n          }\n        });\n      });\n    }\n\n    function onLoad() {\n      var _image$value3;\n\n      if (vm.isUnmounted) return;\n      getSrc();\n      pollForSize(image.value);\n      state.value = 'loaded';\n      emit('load', ((_image$value3 = image.value) === null || _image$value3 === void 0 ? void 0 : _image$value3.currentSrc) || normalisedSrc.value.src);\n    }\n\n    function onError() {\n      var _image$value4;\n\n      if (vm.isUnmounted) return;\n      state.value = 'error';\n      emit('error', ((_image$value4 = image.value) === null || _image$value4 === void 0 ? void 0 : _image$value4.currentSrc) || normalisedSrc.value.src);\n    }\n\n    function getSrc() {\n      var img = image.value;\n      if (img) currentSrc.value = img.currentSrc || img.src;\n    }\n\n    var timer = -1;\n    onBeforeUnmount(function () {\n      clearTimeout(timer);\n    });\n\n    function pollForSize(img) {\n      var timeout = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 100;\n\n      var poll = function poll() {\n        clearTimeout(timer);\n        if (vm.isUnmounted) return;\n        var imgHeight = img.naturalHeight,\n            imgWidth = img.naturalWidth;\n\n        if (imgHeight || imgWidth) {\n          naturalWidth.value = imgWidth;\n          naturalHeight.value = imgHeight;\n        } else if (!img.complete && state.value === 'loading' && timeout != null) {\n          timer = window.setTimeout(poll, timeout);\n        } else if (img.currentSrc.endsWith('.svg') || img.currentSrc.startsWith('data:image/svg+xml')) {\n          naturalWidth.value = 1;\n          naturalHeight.value = 1;\n        }\n      };\n\n      poll();\n    }\n\n    var containClasses = computed(function () {\n      return {\n        'v-img__img--cover': props.cover,\n        'v-img__img--contain': !props.cover\n      };\n    });\n\n    var __image = function __image() {\n      var _slots$sources;\n\n      if (!normalisedSrc.value.src || state.value === 'idle') return null;\n\n      var img = _createVNode(\"img\", {\n        \"class\": ['v-img__img', containClasses.value],\n        \"style\": {\n          objectPosition: props.position\n        },\n        \"crossorigin\": props.crossorigin,\n        \"src\": normalisedSrc.value.src,\n        \"srcset\": normalisedSrc.value.srcset,\n        \"alt\": props.alt,\n        \"referrerpolicy\": props.referrerpolicy,\n        \"draggable\": props.draggable,\n        \"sizes\": props.sizes,\n        \"ref\": image,\n        \"onLoad\": onLoad,\n        \"onError\": onError\n      }, null);\n\n      var sources = (_slots$sources = slots.sources) === null || _slots$sources === void 0 ? void 0 : _slots$sources.call(slots);\n      return _createVNode(MaybeTransition, {\n        \"transition\": props.transition,\n        \"appear\": true\n      }, {\n        default: function _default() {\n          return [withDirectives(sources ? _createVNode(\"picture\", {\n            \"class\": \"v-img__picture\"\n          }, [sources, img]) : img, [[vShow, state.value === 'loaded']])];\n        }\n      });\n    };\n\n    var __preloadImage = function __preloadImage() {\n      return _createVNode(MaybeTransition, {\n        \"transition\": props.transition\n      }, {\n        default: function _default() {\n          return [normalisedSrc.value.lazySrc && state.value !== 'loaded' && _createVNode(\"img\", {\n            \"class\": ['v-img__img', 'v-img__img--preload', containClasses.value],\n            \"style\": {\n              objectPosition: props.position\n            },\n            \"crossorigin\": props.crossorigin,\n            \"src\": normalisedSrc.value.lazySrc,\n            \"alt\": props.alt,\n            \"referrerpolicy\": props.referrerpolicy,\n            \"draggable\": props.draggable\n          }, null)];\n        }\n      });\n    };\n\n    var __placeholder = function __placeholder() {\n      if (!slots.placeholder) return null;\n      return _createVNode(MaybeTransition, {\n        \"transition\": props.transition,\n        \"appear\": true\n      }, {\n        default: function _default() {\n          return [(state.value === 'loading' || state.value === 'error' && !slots.error) && _createVNode(\"div\", {\n            \"class\": \"v-img__placeholder\"\n          }, [slots.placeholder()])];\n        }\n      });\n    };\n\n    var __error = function __error() {\n      if (!slots.error) return null;\n      return _createVNode(MaybeTransition, {\n        \"transition\": props.transition,\n        \"appear\": true\n      }, {\n        default: function _default() {\n          return [state.value === 'error' && _createVNode(\"div\", {\n            \"class\": \"v-img__error\"\n          }, [slots.error()])];\n        }\n      });\n    };\n\n    var __gradient = function __gradient() {\n      if (!props.gradient) return null;\n      return _createVNode(\"div\", {\n        \"class\": \"v-img__gradient\",\n        \"style\": {\n          backgroundImage: \"linear-gradient(\".concat(props.gradient, \")\")\n        }\n      }, null);\n    };\n\n    var isBooted = shallowRef(false);\n    {\n      var stop = watch(aspectRatio, function (val) {\n        if (val) {\n          // Doesn't work with nextTick, idk why\n          requestAnimationFrame(function () {\n            requestAnimationFrame(function () {\n              isBooted.value = true;\n            });\n          });\n          stop();\n        }\n      });\n    }\n    useRender(function () {\n      var responsiveProps = VResponsive.filterProps(props);\n      return _withDirectives(_createVNode(VResponsive, _mergeProps({\n        \"class\": ['v-img', {\n          'v-img--absolute': props.absolute,\n          'v-img--booting': !isBooted.value\n        }, backgroundColorClasses.value, roundedClasses.value, props.class],\n        \"style\": [{\n          width: convertToUnit(props.width === 'auto' ? naturalWidth.value : props.width)\n        }, backgroundColorStyles.value, props.style]\n      }, responsiveProps, {\n        \"aspectRatio\": aspectRatio.value,\n        \"aria-label\": props.alt,\n        \"role\": props.alt ? 'img' : undefined\n      }), {\n        additional: function additional() {\n          return _createVNode(_Fragment, null, [_createVNode(__image, null, null), _createVNode(__preloadImage, null, null), _createVNode(__gradient, null, null), _createVNode(__placeholder, null, null), _createVNode(__error, null, null)]);\n        },\n        default: slots.default\n      }), [[_resolveDirective(\"intersect\"), {\n        handler: init,\n        options: props.options\n      }, null, {\n        once: true\n      }]]);\n    });\n    return {\n      currentSrc: currentSrc,\n      image: image,\n      state: state,\n      naturalWidth: naturalWidth,\n      naturalHeight: naturalHeight\n    };\n  }\n});","map":{"version":3,"mappings":"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","names":["makeVResponsiveProps","VResponsive","useBackgroundColor","makeComponentProps","makeRoundedProps","useRounded","makeTransitionProps","MaybeTransition","intersect","computed","nextTick","onBeforeMount","onBeforeUnmount","ref","shallowRef","toRef","vShow","watch","withDirectives","convertToUnit","genericComponent","getCurrentInstance","propsFactory","SUPPORTS_INTERSECTION","useRender","makeVImgProps","absolute","Boolean","alt","String","cover","color","draggable","type","default","undefined","eager","gradient","lazySrc","options","Object","root","rootMargin","threshold","sizes","src","crossorigin","referrerpolicy","srcset","position","VImg","name","directives","props","emits","loadstart","value","load","error","setup","_ref","emit","slots","backgroundColorClasses","backgroundColorStyles","roundedClasses","vm","currentSrc","image","state","naturalWidth","naturalHeight","normalisedSrc","aspect","Number","aspectRatio","init","val","oldVal","pollForSize","isIntersecting","lazyImg","Image","setTimeout","isUnmounted","complete","onError","onLoad","getSrc","img","timer","clearTimeout","timeout","poll","imgHeight","imgWidth","window","endsWith","startsWith","containClasses","__image","objectPosition","sources","transition","__preloadImage","_createVNode","__placeholder","placeholder","__error","__gradient","backgroundImage","isBooted","stop","requestAnimationFrame","responsiveProps","filterProps","class","width","style","additional","handler","once"],"sources":["../../../src/components/VImg/VImg.tsx"],"sourcesContent":["// Styles\nimport './VImg.sass'\n\n// Components\nimport { makeVResponsiveProps, VResponsive } from '@/components/VResponsive/VResponsive'\n\n// Composables\nimport { useBackgroundColor } from '@/composables/color'\nimport { makeComponentProps } from '@/composables/component'\nimport { makeRoundedProps, useRounded } from '@/composables/rounded'\nimport { makeTransitionProps, MaybeTransition } from '@/composables/transition'\n\n// Directives\nimport intersect from '@/directives/intersect'\n\n// Utilities\nimport {\n  computed,\n  nextTick,\n  onBeforeMount,\n  onBeforeUnmount,\n  ref,\n  shallowRef,\n  toRef,\n  vShow,\n  watch,\n  withDirectives,\n} from 'vue'\nimport {\n  convertToUnit,\n  genericComponent,\n  getCurrentInstance,\n  propsFactory,\n  SUPPORTS_INTERSECTION,\n  useRender,\n} from '@/util'\n\n// Types\nimport type { PropType } from 'vue'\n\n// not intended for public use, this is passed in by vuetify-loader\nexport interface srcObject {\n  src?: string\n  srcset?: string\n  lazySrc?: string\n  aspect: number\n}\n\nexport type VImgSlots = {\n  default: never\n  placeholder: never\n  error: never\n  sources: never\n}\n\nexport const makeVImgProps = propsFactory({\n  absolute: Boolean,\n  alt: String,\n  cover: Boolean,\n  color: String,\n  draggable: {\n    type: [Boolean, String] as PropType<boolean | 'true' | 'false'>,\n    default: undefined,\n  },\n  eager: Boolean,\n  gradient: String,\n  lazySrc: String,\n  options: {\n    type: Object as PropType<IntersectionObserverInit>,\n    // For more information on types, navigate to:\n    // https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API\n    default: () => ({\n      root: undefined,\n      rootMargin: undefined,\n      threshold: undefined,\n    }),\n  },\n  sizes: String,\n  src: {\n    type: [String, Object] as PropType<string | srcObject>,\n    default: '',\n  },\n  crossorigin: String as PropType<'' | 'anonymous' | 'use-credentials'>,\n  referrerpolicy: String as PropType<\n    | 'no-referrer'\n    | 'no-referrer-when-downgrade'\n    | 'origin'\n    | 'origin-when-cross-origin'\n    | 'same-origin'\n    | 'strict-origin'\n    | 'strict-origin-when-cross-origin'\n    | 'unsafe-url'\n  >,\n  srcset: String,\n  position: String,\n\n  ...makeVResponsiveProps(),\n  ...makeComponentProps(),\n  ...makeRoundedProps(),\n  ...makeTransitionProps(),\n}, 'VImg')\n\nexport const VImg = genericComponent<VImgSlots>()({\n  name: 'VImg',\n\n  directives: { intersect },\n\n  props: makeVImgProps(),\n\n  emits: {\n    loadstart: (value: string | undefined) => true,\n    load: (value: string | undefined) => true,\n    error: (value: string | undefined) => true,\n  },\n\n  setup (props, { emit, slots }) {\n    const { backgroundColorClasses, backgroundColorStyles } = useBackgroundColor(toRef(props, 'color'))\n    const { roundedClasses } = useRounded(props)\n    const vm = getCurrentInstance('VImg')\n\n    const currentSrc = shallowRef('') // Set from srcset\n    const image = ref<HTMLImageElement>()\n    const state = shallowRef<'idle' | 'loading' | 'loaded' | 'error'>(props.eager ? 'loading' : 'idle')\n    const naturalWidth = shallowRef<number>()\n    const naturalHeight = shallowRef<number>()\n\n    const normalisedSrc = computed<srcObject>(() => {\n      return props.src && typeof props.src === 'object'\n        ? {\n          src: props.src.src,\n          srcset: props.srcset || props.src.srcset,\n          lazySrc: props.lazySrc || props.src.lazySrc,\n          aspect: Number(props.aspectRatio || props.src.aspect || 0),\n        } : {\n          src: props.src,\n          srcset: props.srcset,\n          lazySrc: props.lazySrc,\n          aspect: Number(props.aspectRatio || 0),\n        }\n    })\n    const aspectRatio = computed(() => {\n      return normalisedSrc.value.aspect || naturalWidth.value! / naturalHeight.value! || 0\n    })\n\n    watch(() => props.src, () => {\n      init(state.value !== 'idle')\n    })\n    watch(aspectRatio, (val, oldVal) => {\n      if (!val && oldVal && image.value) {\n        pollForSize(image.value)\n      }\n    })\n\n    // TODO: getSrc when window width changes\n\n    onBeforeMount(() => init())\n\n    function init (isIntersecting?: boolean) {\n      if (props.eager && isIntersecting) return\n      if (\n        SUPPORTS_INTERSECTION &&\n        !isIntersecting &&\n        !props.eager\n      ) return\n\n      state.value = 'loading'\n\n      if (normalisedSrc.value.lazySrc) {\n        const lazyImg = new Image()\n        lazyImg.src = normalisedSrc.value.lazySrc\n        pollForSize(lazyImg, null)\n      }\n\n      if (!normalisedSrc.value.src) return\n\n      nextTick(() => {\n        emit('loadstart', image.value?.currentSrc || normalisedSrc.value.src)\n\n        setTimeout(() => {\n          if (vm.isUnmounted) return\n\n          if (image.value?.complete) {\n            if (!image.value.naturalWidth) {\n              onError()\n            }\n\n            if (state.value === 'error') return\n\n            if (!aspectRatio.value) pollForSize(image.value, null)\n            if (state.value === 'loading') onLoad()\n          } else {\n            if (!aspectRatio.value) pollForSize(image.value!)\n            getSrc()\n          }\n        })\n      })\n    }\n\n    function onLoad () {\n      if (vm.isUnmounted) return\n\n      getSrc()\n      pollForSize(image.value!)\n      state.value = 'loaded'\n      emit('load', image.value?.currentSrc || normalisedSrc.value.src)\n    }\n\n    function onError () {\n      if (vm.isUnmounted) return\n\n      state.value = 'error'\n      emit('error', image.value?.currentSrc || normalisedSrc.value.src)\n    }\n\n    function getSrc () {\n      const img = image.value\n      if (img) currentSrc.value = img.currentSrc || img.src\n    }\n\n    let timer = -1\n\n    onBeforeUnmount(() => {\n      clearTimeout(timer)\n    })\n\n    function pollForSize (img: HTMLImageElement, timeout: number | null = 100) {\n      const poll = () => {\n        clearTimeout(timer)\n        if (vm.isUnmounted) return\n\n        const { naturalHeight: imgHeight, naturalWidth: imgWidth } = img\n\n        if (imgHeight || imgWidth) {\n          naturalWidth.value = imgWidth\n          naturalHeight.value = imgHeight\n        } else if (!img.complete && state.value === 'loading' && timeout != null) {\n          timer = window.setTimeout(poll, timeout)\n        } else if (img.currentSrc.endsWith('.svg') || img.currentSrc.startsWith('data:image/svg+xml')) {\n          naturalWidth.value = 1\n          naturalHeight.value = 1\n        }\n      }\n\n      poll()\n    }\n\n    const containClasses = computed(() => ({\n      'v-img__img--cover': props.cover,\n      'v-img__img--contain': !props.cover,\n    }))\n\n    const __image = () => {\n      if (!normalisedSrc.value.src || state.value === 'idle') return null\n\n      const img = (\n        <img\n          class={['v-img__img', containClasses.value]}\n          style={{ objectPosition: props.position }}\n          crossorigin={ props.crossorigin }\n          src={ normalisedSrc.value.src }\n          srcset={ normalisedSrc.value.srcset }\n          alt={ props.alt }\n          referrerpolicy={ props.referrerpolicy }\n          draggable={ props.draggable }\n          sizes={ props.sizes }\n          ref={ image }\n          onLoad={ onLoad }\n          onError={ onError }\n        />\n      )\n\n      const sources = slots.sources?.()\n\n      return (\n        <MaybeTransition transition={ props.transition } appear>\n          {\n            withDirectives(\n              sources\n                ? <picture class=\"v-img__picture\">{ sources }{ img }</picture>\n                : img,\n              [[vShow, state.value === 'loaded']]\n            )\n          }\n        </MaybeTransition>\n      )\n    }\n\n    const __preloadImage = () => (\n      <MaybeTransition transition={ props.transition }>\n        { normalisedSrc.value.lazySrc && state.value !== 'loaded' && (\n          <img\n            class={['v-img__img', 'v-img__img--preload', containClasses.value]}\n            style={{ objectPosition: props.position }}\n            crossorigin={ props.crossorigin }\n            src={ normalisedSrc.value.lazySrc }\n            alt={ props.alt }\n            referrerpolicy={ props.referrerpolicy }\n            draggable={ props.draggable }\n          />\n        )}\n      </MaybeTransition>\n    )\n\n    const __placeholder = () => {\n      if (!slots.placeholder) return null\n\n      return (\n        <MaybeTransition transition={ props.transition } appear>\n          { (state.value === 'loading' || (state.value === 'error' && !slots.error)) &&\n          <div class=\"v-img__placeholder\">{ slots.placeholder() }</div>\n          }\n        </MaybeTransition>\n      )\n    }\n\n    const __error = () => {\n      if (!slots.error) return null\n\n      return (\n        <MaybeTransition transition={ props.transition } appear>\n          { state.value === 'error' &&\n            <div class=\"v-img__error\">{ slots.error() }</div>\n          }\n        </MaybeTransition>\n      )\n    }\n\n    const __gradient = () => {\n      if (!props.gradient) return null\n\n      return <div class=\"v-img__gradient\" style={{ backgroundImage: `linear-gradient(${props.gradient})` }} />\n    }\n\n    const isBooted = shallowRef(false)\n    {\n      const stop = watch(aspectRatio, val => {\n        if (val) {\n          // Doesn't work with nextTick, idk why\n          requestAnimationFrame(() => {\n            requestAnimationFrame(() => {\n              isBooted.value = true\n            })\n          })\n          stop()\n        }\n      })\n    }\n\n    useRender(() => {\n      const responsiveProps = VResponsive.filterProps(props)\n      return (\n        <VResponsive\n          class={[\n            'v-img',\n            {\n              'v-img--absolute': props.absolute,\n              'v-img--booting': !isBooted.value,\n            },\n            backgroundColorClasses.value,\n            roundedClasses.value,\n            props.class,\n          ]}\n          style={[\n            { width: convertToUnit(props.width === 'auto' ? naturalWidth.value : props.width) },\n            backgroundColorStyles.value,\n            props.style,\n          ]}\n          { ...responsiveProps }\n          aspectRatio={ aspectRatio.value }\n          aria-label={ props.alt }\n          role={ props.alt ? 'img' : undefined }\n          v-intersect={[{\n            handler: init,\n            options: props.options,\n          }, null, ['once']]}\n        >{{\n          additional: () => (\n            <>\n              <__image />\n              <__preloadImage />\n              <__gradient />\n              <__placeholder />\n              <__error />\n            </>\n          ),\n          default: slots.default,\n        }}</VResponsive>\n      )\n    })\n\n    return {\n      currentSrc,\n      image,\n      state,\n      naturalWidth,\n      naturalHeight,\n    }\n  },\n})\n\nexport type VImg = InstanceType<typeof VImg>\n"]},"metadata":{},"sourceType":"module"}