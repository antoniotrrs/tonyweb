{"ast":null,"code":"import _objectSpread from \"/Users/antoniotorres/Documents/tony/tonyweb/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\n// Components\nimport { VMenuSymbol } from \"../VMenu/shared.js\"; // Composables\n\nimport { makeDelayProps, useDelay } from \"../../composables/delay.js\"; // Utilities\n\nimport { computed, effectScope, inject, mergeProps, nextTick, onScopeDispose, ref, watch, watchEffect } from 'vue';\nimport { bindProps, getCurrentInstance, IN_BROWSER, matchesSelector, propsFactory, templateRef, unbindProps } from \"../../util/index.js\"; // Types\n\nexport var makeActivatorProps = propsFactory(_objectSpread({\n  target: [String, Object],\n  activator: [String, Object],\n  activatorProps: {\n    type: Object,\n    default: function _default() {\n      return {};\n    }\n  },\n  openOnClick: {\n    type: Boolean,\n    default: undefined\n  },\n  openOnHover: Boolean,\n  openOnFocus: {\n    type: Boolean,\n    default: undefined\n  },\n  closeOnContentClick: Boolean\n}, makeDelayProps()), 'VOverlay-activator');\nexport function useActivator(props, _ref) {\n  var isActive = _ref.isActive,\n      isTop = _ref.isTop,\n      contentEl = _ref.contentEl;\n  var vm = getCurrentInstance('useActivator');\n  var activatorEl = ref();\n  var isHovered = false;\n  var isFocused = false;\n  var firstEnter = true;\n  var openOnFocus = computed(function () {\n    return props.openOnFocus || props.openOnFocus == null && props.openOnHover;\n  });\n  var openOnClick = computed(function () {\n    return props.openOnClick || props.openOnClick == null && !props.openOnHover && !openOnFocus.value;\n  });\n\n  var _useDelay = useDelay(props, function (value) {\n    if (value === (props.openOnHover && isHovered || openOnFocus.value && isFocused) && !(props.openOnHover && isActive.value && !isTop.value)) {\n      if (isActive.value !== value) {\n        firstEnter = true;\n      }\n\n      isActive.value = value;\n    }\n  }),\n      runOpenDelay = _useDelay.runOpenDelay,\n      runCloseDelay = _useDelay.runCloseDelay;\n\n  var cursorTarget = ref();\n  var availableEvents = {\n    onClick: function onClick(e) {\n      e.stopPropagation();\n      activatorEl.value = e.currentTarget || e.target;\n\n      if (!isActive.value) {\n        cursorTarget.value = [e.clientX, e.clientY];\n      }\n\n      isActive.value = !isActive.value;\n    },\n    onMouseenter: function onMouseenter(e) {\n      var _e$sourceCapabilities;\n\n      if ((_e$sourceCapabilities = e.sourceCapabilities) !== null && _e$sourceCapabilities !== void 0 && _e$sourceCapabilities.firesTouchEvents) return;\n      isHovered = true;\n      activatorEl.value = e.currentTarget || e.target;\n      runOpenDelay();\n    },\n    onMouseleave: function onMouseleave(e) {\n      isHovered = false;\n      runCloseDelay();\n    },\n    onFocus: function onFocus(e) {\n      if (matchesSelector(e.target, ':focus-visible') === false) return;\n      isFocused = true;\n      e.stopPropagation();\n      activatorEl.value = e.currentTarget || e.target;\n      runOpenDelay();\n    },\n    onBlur: function onBlur(e) {\n      isFocused = false;\n      e.stopPropagation();\n      runCloseDelay();\n    }\n  };\n  var activatorEvents = computed(function () {\n    var events = {};\n\n    if (openOnClick.value) {\n      events.onClick = availableEvents.onClick;\n    }\n\n    if (props.openOnHover) {\n      events.onMouseenter = availableEvents.onMouseenter;\n      events.onMouseleave = availableEvents.onMouseleave;\n    }\n\n    if (openOnFocus.value) {\n      events.onFocus = availableEvents.onFocus;\n      events.onBlur = availableEvents.onBlur;\n    }\n\n    return events;\n  });\n  var contentEvents = computed(function () {\n    var events = {};\n\n    if (props.openOnHover) {\n      events.onMouseenter = function () {\n        isHovered = true;\n        runOpenDelay();\n      };\n\n      events.onMouseleave = function () {\n        isHovered = false;\n        runCloseDelay();\n      };\n    }\n\n    if (openOnFocus.value) {\n      events.onFocusin = function () {\n        isFocused = true;\n        runOpenDelay();\n      };\n\n      events.onFocusout = function () {\n        isFocused = false;\n        runCloseDelay();\n      };\n    }\n\n    if (props.closeOnContentClick) {\n      var menu = inject(VMenuSymbol, null);\n\n      events.onClick = function () {\n        isActive.value = false;\n        menu === null || menu === void 0 ? void 0 : menu.closeParents();\n      };\n    }\n\n    return events;\n  });\n  var scrimEvents = computed(function () {\n    var events = {};\n\n    if (props.openOnHover) {\n      events.onMouseenter = function () {\n        if (firstEnter) {\n          isHovered = true;\n          firstEnter = false;\n          runOpenDelay();\n        }\n      };\n\n      events.onMouseleave = function () {\n        isHovered = false;\n        runCloseDelay();\n      };\n    }\n\n    return events;\n  });\n  watch(isTop, function (val) {\n    var _contentEl$value;\n\n    if (val && (props.openOnHover && !isHovered && (!openOnFocus.value || !isFocused) || openOnFocus.value && !isFocused && (!props.openOnHover || !isHovered)) && !((_contentEl$value = contentEl.value) !== null && _contentEl$value !== void 0 && _contentEl$value.contains(document.activeElement))) {\n      isActive.value = false;\n    }\n  });\n  watch(isActive, function (val) {\n    if (!val) {\n      setTimeout(function () {\n        cursorTarget.value = undefined;\n      });\n    }\n  }, {\n    flush: 'post'\n  });\n  var activatorRef = templateRef();\n  watchEffect(function () {\n    if (!activatorRef.value) return;\n    nextTick(function () {\n      activatorEl.value = activatorRef.el;\n    });\n  });\n  var targetRef = templateRef();\n  var target = computed(function () {\n    if (props.target === 'cursor' && cursorTarget.value) return cursorTarget.value;\n    if (targetRef.value) return targetRef.el;\n    return getTarget(props.target, vm) || activatorEl.value;\n  });\n  var targetEl = computed(function () {\n    return Array.isArray(target.value) ? undefined : target.value;\n  });\n  var scope;\n  watch(function () {\n    return !!props.activator;\n  }, function (val) {\n    if (val && IN_BROWSER) {\n      scope = effectScope();\n      scope.run(function () {\n        _useActivator(props, vm, {\n          activatorEl: activatorEl,\n          activatorEvents: activatorEvents\n        });\n      });\n    } else if (scope) {\n      scope.stop();\n    }\n  }, {\n    flush: 'post',\n    immediate: true\n  });\n  onScopeDispose(function () {\n    var _scope;\n\n    (_scope = scope) === null || _scope === void 0 ? void 0 : _scope.stop();\n  });\n  return {\n    activatorEl: activatorEl,\n    activatorRef: activatorRef,\n    target: target,\n    targetEl: targetEl,\n    targetRef: targetRef,\n    activatorEvents: activatorEvents,\n    contentEvents: contentEvents,\n    scrimEvents: scrimEvents\n  };\n}\n\nfunction _useActivator(props, vm, _ref2) {\n  var activatorEl = _ref2.activatorEl,\n      activatorEvents = _ref2.activatorEvents;\n  watch(function () {\n    return props.activator;\n  }, function (val, oldVal) {\n    if (oldVal && val !== oldVal) {\n      var activator = getActivator(oldVal);\n      activator && unbindActivatorProps(activator);\n    }\n\n    if (val) {\n      nextTick(function () {\n        return bindActivatorProps();\n      });\n    }\n  }, {\n    immediate: true\n  });\n  watch(function () {\n    return props.activatorProps;\n  }, function () {\n    bindActivatorProps();\n  });\n  onScopeDispose(function () {\n    unbindActivatorProps();\n  });\n\n  function bindActivatorProps() {\n    var el = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : getActivator();\n\n    var _props = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : props.activatorProps;\n\n    if (!el) return;\n    bindProps(el, mergeProps(activatorEvents.value, _props));\n  }\n\n  function unbindActivatorProps() {\n    var el = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : getActivator();\n\n    var _props = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : props.activatorProps;\n\n    if (!el) return;\n    unbindProps(el, mergeProps(activatorEvents.value, _props));\n  }\n\n  function getActivator() {\n    var selector = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : props.activator;\n    var activator = getTarget(selector, vm); // The activator should only be a valid element (Ignore comments and text nodes)\n\n    activatorEl.value = (activator === null || activator === void 0 ? void 0 : activator.nodeType) === Node.ELEMENT_NODE ? activator : undefined;\n    return activatorEl.value;\n  }\n}\n\nfunction getTarget(selector, vm) {\n  if (!selector) return;\n  var target;\n\n  if (selector === 'parent') {\n    var _vm$proxy, _vm$proxy$$el;\n\n    var el = vm === null || vm === void 0 ? void 0 : (_vm$proxy = vm.proxy) === null || _vm$proxy === void 0 ? void 0 : (_vm$proxy$$el = _vm$proxy.$el) === null || _vm$proxy$$el === void 0 ? void 0 : _vm$proxy$$el.parentNode;\n\n    while ((_el = el) !== null && _el !== void 0 && _el.hasAttribute('data-no-activator')) {\n      var _el;\n\n      el = el.parentNode;\n    }\n\n    target = el;\n  } else if (typeof selector === 'string') {\n    // Selector\n    target = document.querySelector(selector);\n  } else if ('$el' in selector) {\n    // Component (ref)\n    target = selector.$el;\n  } else {\n    // HTMLElement | Element | [x, y]\n    target = selector;\n  }\n\n  return target;\n}","map":{"version":3,"mappings":"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","names":["VMenuSymbol","makeDelayProps","useDelay","computed","effectScope","inject","mergeProps","nextTick","onScopeDispose","ref","watch","watchEffect","bindProps","getCurrentInstance","IN_BROWSER","matchesSelector","propsFactory","templateRef","unbindProps","makeActivatorProps","target","String","Object","activator","activatorProps","type","default","openOnClick","Boolean","undefined","openOnHover","openOnFocus","closeOnContentClick","useActivator","props","_ref","isActive","isTop","contentEl","vm","activatorEl","isHovered","isFocused","firstEnter","value","runOpenDelay","runCloseDelay","cursorTarget","availableEvents","onClick","e","stopPropagation","currentTarget","clientX","clientY","onMouseenter","sourceCapabilities","firesTouchEvents","onMouseleave","onFocus","onBlur","activatorEvents","events","contentEvents","onFocusin","onFocusout","menu","closeParents","scrimEvents","val","contains","document","activeElement","setTimeout","flush","activatorRef","el","targetRef","getTarget","targetEl","Array","isArray","scope","run","_useActivator","stop","immediate","_ref2","oldVal","getActivator","unbindActivatorProps","bindActivatorProps","_props","selector","nodeType","Node","ELEMENT_NODE","proxy","$el","parentNode","hasAttribute","querySelector"],"sources":["../../../src/components/VOverlay/useActivator.tsx"],"sourcesContent":["// Components\nimport { VMenuSymbol } from '@/components/VMenu/shared'\n\n// Composables\nimport { makeDelayProps, useDelay } from '@/composables/delay'\n\n// Utilities\nimport {\n  computed,\n  effectScope,\n  inject,\n  mergeProps,\n  nextTick,\n  onScopeDispose,\n  ref,\n  watch,\n  watchEffect,\n} from 'vue'\nimport {\n  bindProps,\n  getCurrentInstance,\n  IN_BROWSER,\n  matchesSelector,\n  propsFactory,\n  templateRef,\n  unbindProps,\n} from '@/util'\n\n// Types\nimport type {\n  ComponentInternalInstance,\n  ComponentPublicInstance,\n  EffectScope,\n  PropType,\n  Ref,\n} from 'vue'\nimport type { DelayProps } from '@/composables/delay'\n\ninterface ActivatorProps extends DelayProps {\n  target: 'parent' | 'cursor' | (string & {}) | Element | ComponentPublicInstance | [x: number, y: number] | undefined\n  activator: 'parent' | (string & {}) | Element | ComponentPublicInstance | undefined\n  activatorProps: Record<string, any>\n\n  openOnClick: boolean | undefined\n  openOnHover: boolean\n  openOnFocus: boolean | undefined\n\n  closeOnContentClick: boolean\n}\n\nexport const makeActivatorProps = propsFactory({\n  target: [String, Object] as PropType<ActivatorProps['target']>,\n  activator: [String, Object] as PropType<ActivatorProps['activator']>,\n  activatorProps: {\n    type: Object as PropType<ActivatorProps['activatorProps']>,\n    default: () => ({}),\n  },\n\n  openOnClick: {\n    type: Boolean,\n    default: undefined,\n  },\n  openOnHover: Boolean,\n  openOnFocus: {\n    type: Boolean,\n    default: undefined,\n  },\n\n  closeOnContentClick: Boolean,\n\n  ...makeDelayProps(),\n}, 'VOverlay-activator')\n\nexport function useActivator (\n  props: ActivatorProps,\n  { isActive, isTop, contentEl }: {\n    isActive: Ref<boolean>\n    isTop: Ref<boolean>\n    contentEl: Ref<HTMLElement | undefined>\n  }\n) {\n  const vm = getCurrentInstance('useActivator')\n  const activatorEl = ref<HTMLElement>()\n\n  let isHovered = false\n  let isFocused = false\n  let firstEnter = true\n\n  const openOnFocus = computed(() => props.openOnFocus || (props.openOnFocus == null && props.openOnHover))\n  const openOnClick = computed(() => props.openOnClick || (props.openOnClick == null && !props.openOnHover && !openOnFocus.value))\n\n  const { runOpenDelay, runCloseDelay } = useDelay(props, value => {\n    if (\n      value === (\n        (props.openOnHover && isHovered) ||\n        (openOnFocus.value && isFocused)\n      ) && !(props.openOnHover && isActive.value && !isTop.value)\n    ) {\n      if (isActive.value !== value) {\n        firstEnter = true\n      }\n      isActive.value = value\n    }\n  })\n\n  const cursorTarget = ref<[x: number, y: number]>()\n  const availableEvents = {\n    onClick: (e: MouseEvent) => {\n      e.stopPropagation()\n      activatorEl.value = (e.currentTarget || e.target) as HTMLElement\n      if (!isActive.value) {\n        cursorTarget.value = [e.clientX, e.clientY]\n      }\n      isActive.value = !isActive.value\n    },\n    onMouseenter: (e: MouseEvent) => {\n      if (e.sourceCapabilities?.firesTouchEvents) return\n\n      isHovered = true\n      activatorEl.value = (e.currentTarget || e.target) as HTMLElement\n      runOpenDelay()\n    },\n    onMouseleave: (e: MouseEvent) => {\n      isHovered = false\n      runCloseDelay()\n    },\n    onFocus: (e: FocusEvent) => {\n      if (matchesSelector(e.target as HTMLElement, ':focus-visible') === false) return\n\n      isFocused = true\n      e.stopPropagation()\n      activatorEl.value = (e.currentTarget || e.target) as HTMLElement\n\n      runOpenDelay()\n    },\n    onBlur: (e: FocusEvent) => {\n      isFocused = false\n      e.stopPropagation()\n\n      runCloseDelay()\n    },\n  }\n\n  const activatorEvents = computed(() => {\n    const events: Partial<typeof availableEvents> = {}\n\n    if (openOnClick.value) {\n      events.onClick = availableEvents.onClick\n    }\n    if (props.openOnHover) {\n      events.onMouseenter = availableEvents.onMouseenter\n      events.onMouseleave = availableEvents.onMouseleave\n    }\n    if (openOnFocus.value) {\n      events.onFocus = availableEvents.onFocus\n      events.onBlur = availableEvents.onBlur\n    }\n\n    return events\n  })\n\n  const contentEvents = computed(() => {\n    const events: Record<string, EventListener> = {}\n\n    if (props.openOnHover) {\n      events.onMouseenter = () => {\n        isHovered = true\n        runOpenDelay()\n      }\n      events.onMouseleave = () => {\n        isHovered = false\n        runCloseDelay()\n      }\n    }\n\n    if (openOnFocus.value) {\n      events.onFocusin = () => {\n        isFocused = true\n        runOpenDelay()\n      }\n      events.onFocusout = () => {\n        isFocused = false\n        runCloseDelay()\n      }\n    }\n\n    if (props.closeOnContentClick) {\n      const menu = inject(VMenuSymbol, null)\n      events.onClick = () => {\n        isActive.value = false\n        menu?.closeParents()\n      }\n    }\n\n    return events\n  })\n\n  const scrimEvents = computed(() => {\n    const events: Record<string, EventListener> = {}\n\n    if (props.openOnHover) {\n      events.onMouseenter = () => {\n        if (firstEnter) {\n          isHovered = true\n          firstEnter = false\n          runOpenDelay()\n        }\n      }\n      events.onMouseleave = () => {\n        isHovered = false\n        runCloseDelay()\n      }\n    }\n\n    return events\n  })\n\n  watch(isTop, val => {\n    if (val && (\n      (props.openOnHover && !isHovered && (!openOnFocus.value || !isFocused)) ||\n      (openOnFocus.value && !isFocused && (!props.openOnHover || !isHovered))\n    ) && !contentEl.value?.contains(document.activeElement)) {\n      isActive.value = false\n    }\n  })\n\n  watch(isActive, val => {\n    if (!val) {\n      setTimeout(() => {\n        cursorTarget.value = undefined\n      })\n    }\n  }, { flush: 'post' })\n\n  const activatorRef = templateRef()\n  watchEffect(() => {\n    if (!activatorRef.value) return\n\n    nextTick(() => {\n      activatorEl.value = activatorRef.el\n    })\n  })\n\n  const targetRef = templateRef()\n  const target = computed(() => {\n    if (props.target === 'cursor' && cursorTarget.value) return cursorTarget.value\n    if (targetRef.value) return targetRef.el\n    return getTarget(props.target, vm) || activatorEl.value\n  })\n  const targetEl = computed(() => {\n    return Array.isArray(target.value)\n      ? undefined\n      : target.value\n  })\n\n  let scope: EffectScope\n  watch(() => !!props.activator, val => {\n    if (val && IN_BROWSER) {\n      scope = effectScope()\n      scope.run(() => {\n        _useActivator(props, vm, { activatorEl, activatorEvents })\n      })\n    } else if (scope) {\n      scope.stop()\n    }\n  }, { flush: 'post', immediate: true })\n\n  onScopeDispose(() => {\n    scope?.stop()\n  })\n\n  return { activatorEl, activatorRef, target, targetEl, targetRef, activatorEvents, contentEvents, scrimEvents }\n}\n\nfunction _useActivator (\n  props: ActivatorProps,\n  vm: ComponentInternalInstance,\n  { activatorEl, activatorEvents }: Pick<ReturnType<typeof useActivator>, 'activatorEl' | 'activatorEvents'>\n) {\n  watch(() => props.activator, (val, oldVal) => {\n    if (oldVal && val !== oldVal) {\n      const activator = getActivator(oldVal)\n      activator && unbindActivatorProps(activator)\n    }\n    if (val) {\n      nextTick(() => bindActivatorProps())\n    }\n  }, { immediate: true })\n\n  watch(() => props.activatorProps, () => {\n    bindActivatorProps()\n  })\n\n  onScopeDispose(() => {\n    unbindActivatorProps()\n  })\n\n  function bindActivatorProps (el = getActivator(), _props = props.activatorProps) {\n    if (!el) return\n\n    bindProps(el, mergeProps(activatorEvents.value, _props))\n  }\n\n  function unbindActivatorProps (el = getActivator(), _props = props.activatorProps) {\n    if (!el) return\n\n    unbindProps(el, mergeProps(activatorEvents.value, _props))\n  }\n\n  function getActivator (selector = props.activator): HTMLElement | undefined {\n    const activator = getTarget(selector, vm)\n\n    // The activator should only be a valid element (Ignore comments and text nodes)\n    activatorEl.value = activator?.nodeType === Node.ELEMENT_NODE ? activator : undefined\n\n    return activatorEl.value\n  }\n}\n\nfunction getTarget<T extends 'parent' | string | Element | ComponentPublicInstance | [x: number, y: number] | undefined> (\n  selector: T,\n  vm: ComponentInternalInstance\n): HTMLElement | undefined | (T extends any[] ? [x: number, y: number] : never) {\n  if (!selector) return\n\n  let target\n  if (selector === 'parent') {\n    let el = vm?.proxy?.$el?.parentNode\n    while (el?.hasAttribute('data-no-activator')) {\n      el = el.parentNode\n    }\n    target = el\n  } else if (typeof selector === 'string') {\n    // Selector\n    target = document.querySelector(selector)\n  } else if ('$el' in selector) {\n    // Component (ref)\n    target = selector.$el\n  } else {\n    // HTMLElement | Element | [x, y]\n    target = selector\n  }\n\n  return target\n}\n"]},"metadata":{},"sourceType":"module"}